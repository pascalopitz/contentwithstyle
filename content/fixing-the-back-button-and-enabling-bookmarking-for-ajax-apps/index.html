<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />

<link rel="stylesheet" href="/default/css/shared.css" type="text/css" media="screen" />
<!--[if lte IE 6]><link rel="stylesheet" type="text/css" media="screen" href="/default/css/ie6.css" /><![endif]-->
<!--[if gte IE 7]><link rel="stylesheet" type="text/css" media="screen" href="/default/css/ie7.css" /><![endif]-->

<meta http-equiv="content-language" content="en" />

<meta name="author" content="Content with Style" />
<meta name="copyright" content="Content with Style" />
<meta name="publisher" content="Content with Style" />

<meta name="robots" content="all" />
<meta name="revisit-after" content="2 days" />

<link rel="alternate" type="rss" href="/atom.xml" />
<link rel="shortcut icon" type="image/ico" href="/favicon.ico" />

<title>Content with Style - Fixing the Back Button and Enabling Bookmarking for AJAX Apps</title>



        <link rel="stylesheet" title="Default" href="/3rdparty/highlight/styles/github.css">
    </head>

    <body class="article">

        <div class="header">
            <div class="inner">
                <ul class="clearfix">
                    <li><a href="/" class="home">Home</a></li>
                    <li><a href="/archive" class="archive">Archive</a></li>
                </ul>
            </div>
        </div>

        <div class="title-row">
    <div>
        <strong>Content with Style</strong>
        <p>Web Technique</p>
    </div>
</div>


        <div class="content clearfix">
            <div class="main-col">
                <ul class="breadcrumb clearfix">
    <li class="home"><a href="/">Content with Style</a></li>
    <li><a href="/content/fixing-the-back-button-and-enabling-bookmarking-for-ajax-apps/index.html" class="active">Fixing the Back Button and Enabling Bookmarking for AJAX Apps</a></li>
</ul>

<h1>Fixing the Back Button and Enabling Bookmarking for AJAX Apps</h1>

<div class="info clearfix">
    <p class="credit">by Mike Stenhouse on June 15 2005, 09:01</p>
</div>

<div class="article">
    <h2>The problem</h2>
<p>Everyone's favourite AJAX technology app is Google Maps. Google have done a stunning job... But when I came to try to bookmark a page I had to hunt around for 'link to this page' over on the right hand side. Why have they broken such a basic function of the web? I use bookmarks A LOT and the extra effort bothered me. I got over it though, and life went on. </p>

<p>Then I came to flick through the drop down on Kottke.org (now removed) and I kept hitting the back button on my mouse by accident, taking me off the site. Really irritating. The most fundamental online behaviour - click then back, is broken.</p>

<p>I've not picked on these sites for any particular reason. They both happen to be great sites that I visit regularly enough to notice these flaws, which will be common to many AJAX-based applications.</p>

<p>After a chat with <a href="http://www.adactio.com">Jeremy Keith</a>, <a href="http://www.clagnut.com">Rich Rutter</a> and <a href="http://www.andybudd.com">Andy Budd</a> about exactly this problem I decided to take a shot at fixing it.</p>

<p>Read on for the explanation or <a href="http://donotremove.co.uk/extra/ajax-nav/index.html">go straight to the demo</a> to see it in action.</p>

<h2>Standing on the shoulders of giants</h2>
<p>I'm not the first person to tackle this type of problem. I've drawn inspiration and know-how from several places to get this up and running:</p>

<dl>
    <dt>The original bookmark/back button fix, as used by Flash developers for a little while now:</dt>
    <dd><a href="http://www.robertpenner.com/experiments/backbutton/backbutton.html">www.robertpenner.com/experiments/backbutton/flashpage.html</a></dd>

    <dt>I've not actually looked at how they implemented their solution but this is where I got the idea for replacing Robert Penner's frames with iframes:</dt>
    <dd><a href="http://dojotoolkit.org/intro_to_dojo_io.html#so-about-that-thorny-back-button">dojotoolkit.org/intro_to_dojo_io.html#so-about-that-thorny-back-button</a></dd>

    <dt>Rich Rutter's use of the hash for bookmarking:</dt>
    <dd><a href="http://www.clagnut.com/sandbox/slideshow.html#5">www.clagnut.com/sandbox/slideshow.html#5</a></dd>

    <dt>For this little experiment I've used Harry Fuecks' <a href="http://jpspan.sourceforge.net/wiki/doku.php">JPSpan</a> </dt>
    <dd>It's a fantastic framework that makes the methods you define in your server-side PHP classes available to your Javascript via XmlHttpRequest. It's the simplest way I've come across to get started with AJAX. I had the guts of my demo up and running in about 10 minutes!</dd>

    <dt>I'm using Algorithm's Timer object:</dt>
    <dd><a href="http://www.codingforums.com/archive/index.php/t-10531.html">www.codingforums.com/archive/index.php/t-10531.html</a></dd>

    <dt>And Scott Andrew's cross-browser event handler:</dt>
    <dd><a href="http://www.scottandrew.com/weblog/articles/cbs-events">www.scottandrew.com/weblog/articles/cbs-events</a></dd>
</dl>

<h2>Setting things up</h2>
<p>I created a PageLocator object to act as an interface to both real querystrings and my hash pseudo-querystrings. It's nothing complicated but it allows me to access both using the same methods...</p>

<pre>
function PageLocator(propertyToUse, dividingCharacter) {
    this.propertyToUse = propertyToUse;
    this.defaultQS = 1;
    this.dividingCharacter = dividingCharacter;
}
PageLocator.prototype.getLocation = function() {
    return eval(this.propertyToUse);
}
PageLocator.prototype.getHash = function() {
    var url = this.getLocation();
    if(url.indexOf(this.dividingCharacter) &gt; -1) {
        var url_elements = url.split(this.dividingCharacter);
        return url_elements[url_elements.length-1];
    } else {
        return this.defaultQS;
    }
}
PageLocator.prototype.getHref = function() {
    var url = this.getLocation();
    var url_elements = url.split(this.dividingCharacter);
    return url_elements[0];
}
PageLocator.prototype.makeNewLocation = function(new_qs) {
    return this.getHref() + this.dividingCharacter + new_qs;
}
</pre>

<p>I also have a setContent function that simply takes whatever you pass it and inserts it into the content container div on the page. I'm using the innerHtml property because it's really not the point of this demo. If I was doing it properly I'd probably go for something a little cleverer.</p>

<pre>
function setContent(new_content) {
    if(!document.getElementById || !document.getElementsByTagName) return;
    var container = document.getElementById("content");
    container.innerHTML = new_content;
}
</pre>

<p>In the spirit of 'proper' scripting my demo will work with javascript turned off. The links on the page point  to content.php, which loads the same content as the AJAX app, but server side.</p>

<h2>It's all too easy</h2>
<p>So, I'm trying to store the session state in the address bar to allow bookmarking. What can be changed in the URL that won't trigger a page reload? The hash portion. So what I need to do is add my AJAX application's parameters after a #. </p>

<p>There is an additional benefit to this approach: When you click on page anchors, these points are added to the browser's history object so that when you press the back button you're taken back to these points within the same page. That's important because items are being added to the history without leaving the current page. </p>

<p>To make use of this behaviour I wrote written a simple DOM script to change the links on my page into # anchors, with the # portion containing the argument that would have been passed to content.php (the server-side equivalent of this app). This effectively maps the real querystring to a hash pseudo querystring.</p>

<p>Now when the links are clicked, the address bar is changed but the page itself doesn't change. To sync the page content with the URL I've set a Javascript timer to poll the window.location.href property on a regular basis and use any changes to trigger an AJAX content-load action. This effectively de-couples the default browser functionality, so instead of changing the page when a link is pressed, this now happens whenever something in the address bar changes. This means that if we change the URL manually or, importantly, with a bookmark, the page's content is automatically changed to reflect the new url.</p>

<p>To my surprise, it was very simple to get this all set up and working in Firefox. I was even more surprised to see that it worked reasonably well in IE6 as well. Reasonably, but not completely. For some reason, IE wasn't adding my anchors to the history so when I hit back, I was taken off my page and the AJAX app reset its state. </p>

<pre>
function AjaxUrlFixer() {
    this.fixLinks();

    this.locator = new PageLocator("window.location.href", "#");
    this.timer = new Timer(this);
    this.checkWhetherChanged(0);
}
AjaxUrlFixer.prototype.fixLinks = function () {
    var links = document.getElementsByTagName("A");
    for(var i=0; i&lt;links.length; i++) {
        var href = links[i].getAttribute("href");
        var hash = href.substr(href.indexOf("hash=")+5);
        links[i].setAttribute("href","#"+hash);
    }
}
AjaxUrlFixer.prototype.checkWhetherChanged = function(location){
    if(this.locator.getHash() != location) {
        doGetPage(this.locator.getHash());
    }
    this.timer.setTimeout("checkWhetherChanged", 200, this.locator.getHash());
}
</pre>

<h2>Now you're just being difficult</h2>
<p>So, IE won't add my modified anchors to the history object. There is a fix that's been in use by Flash developers for a little while that uses frames to trick the browser into thinking that it's loading new pages, and use that to trap and mimic the back button action within the Flash apps. See <a href="http://www.holler.co.uk">www.holler.co.uk</a> for an example of this in action.</p>

<p>After reading through the Flash back button fix and remembering Dojo Toolkit's reference to their own back button fix I decided to give iframes a shot. The catch is that the iframe has to be present on the page before the DOM tree is complete so it has to be document.written out inline. It's not the cleanest solution because it means that I need to have a script block in the BODY, which I like to avoid, but as far as I know there's no way around that.</p>

<p>With the iframe in, the mechanism is roughly the same... </p>

<p>Instead of changing the links on the page to # anchors, they are modified to change the src attribute of the iframe, loading a page called mock-page.php with a querystring that contains the same argument as the hash did before. A timer polls the iframe for it's location and if it detects a change then a content load is triggered in the AJAX app, same as before. </p>

<p>This is complicated by the fact that the iframe's src property doesn't change when the back button is pressed. To get around this I've written a little function to sit within mock-page.php and report it's location when asked.</p>

<pre>
function getLocation() {
    return '&lt;?php print "http://" . $_SERVER['SERVER_NAME'] . $_SERVER['PHP_SELF'] . "?" . $_SERVER['QUERY_STRING'] ?&gt;';
}
</pre>

<p>When a change in mock-page.php's url is detected an AJAX content load is triggered and the parameters from it's querystring are duplicated into the url, to make sure that bookmarking will still work. It's sounds a bit convoluted but the code is quite straight forward. Except for one thing... IE wouldn't let me access the window.location immediately. I have no idea why... As a simple workaround, I've added a tiny 100ms delay to the firing of the script, which seems to sort it out.</p>

<pre>
function AjaxIframesFixer(iframeid) {
    this.iframeid = iframeid;
    if (document.getElementById('ajaxnav')) {
        this.fixLinks();

        this.locator = new PageLocator("document.frames['"+this.iframeid+"'].getLocation()", "?hash=");
        this.windowlocator = new PageLocator("window.location.href", "#");
        this.timer = new Timer(this);

        this.delayInit(); // required or IE doesn't fire
    }
}
AjaxIframesFixer.prototype.fixLinks = function (iframeid) {
    var links = document.getElementsByTagName("A");
    for(var i=0; i&lt;links.length; i++) {
        var href = links[i].getAttribute("href");
        var hash = href.substr(href.indexOf("hash=")+5);
        links[i].setAttribute("href", "Javascript:document.getElementById('"+this.iframeid+"').setAttribute('src', 'mock-page.php?hash="+hash+"');");
    }
}
AjaxIframesFixer.prototype.delayInit = function(){
    this.timer.setTimeout("checkBookmark", 100, "");
}
AjaxIframesFixer.prototype.checkBookmark = function(){
    window.location = this.windowlocator.makeNewLocation(this.locator.getHash());
    this.checkWhetherChanged(0);
}
AjaxIframesFixer.prototype.checkWhetherChanged = function(location){
    if(this.locator.getHash() != location) {
        doGetPage(this.locator.getHash());
        window.location = this.windowlocator.makeNewLocation(this.locator.getHash());
    }
    this.timer.setTimeout("checkWhetherChanged", 200, this.locator.getHash());
}
</pre>

<h2>It's not what you said it's how you said it</h2>
<p>I hate branching scripts but I couldn't find a method that would work across all browsers. To make things as easy as possible I've made the fixes objects so they can be plugged or removed as easily as possible.</p>

<pre>
function FixBackAndBookmarking() {
    if(!document.getElementById || !document.getElementsByTagName) return;
    if(document.iframesfix) {
        fix = new AjaxIframesFixer('ajaxnav');
    } else {
        fix = new AjaxUrlFixer();
    }
}
</pre>

<h2>Moving on</h2>

<p>What I've produced here is a simple illustration of a method for storing the browser state in the URL bar, to allow bookmarking, replaced the default browser linking mechanism to use that url-stored state and mimic traditional web behaviour. For a real world application the querystring used is likely to be far more complicated... I've separated out my code into distinct objects to try and make customisation easier.</p>

<p>To see it in action, I have put up <a href="http://donotremove.co.uk/extra/ajax-nav/index.html">a demo page with everything hooked together</a>.</p>

<p>This method could be applied to Flash as well. As far as I know most people are still using the full frames method documented by Robert Penner. Using some Javascript we can do away with that extra complexity to make going back and bookmarking a plug-and-play addition.</p>

<h2>Reservations</h2>
<p>As I was writing this it occurred to me that what I've been doing here is remarkably like the old Frames hacks from back in the day. Should we be trying so hard to duplicate traditional browser behaviour? If it's important enough to put in the effort to duplicate it then should we really be breaking it in the first place? It's a question that can only be answered on a project-by-project basis but it seems important enough to be worth asking...</p>

<h2>Components</h2>

<dl>
    <dt>index.html</dt>
    <dd>The important part, from the point of view of this article. Contains:
        <ul>
            <li>Timer object</li>
            <li>addEvent fix</li>
            <li>JPSpan AJAX functions</li>
            <li>PageLocator object</li>
            <li>AjaxIframesFixer object for IE</li>
            <li>AjaxUrlFixer object for Firefox and others</li>
        </ul>
    </dd>

    <dt>test.php</dt>
    <dd>Sets up JPSpan server side.</dd>

    <dt>mock-page.php</dt>
    <dd>Loaded into iframe. Has getLocation function that reports it's current URL.</dd>

    <dt>pageholder.class.php</dt>
    <dd>Simple class used to serve content. </dd>
</dl>

<table cellpadding="5" cellspacing="0" border="0" summary="Browser support for the back button and bookmarking fix">
<caption>Browser support</caption>
<tr>
    <th>Browser</th>
    <th>Bookmarking</th>
    <th>Back button</th>
</tr>
<tr>
    <td>IE6/PC</td>
    <td>Yes</td>
    <td>Yes</td>
</tr>
<tr>
    <td>IE5.5/PC</td>
    <td>Yes</td>
    <td>Yes</td>
</tr>
<tr>
    <td>IE5/PC</td>
    <td>Yes</td>
    <td>Yes</td>
</tr>
<tr>
    <td>IE5/Mac</td>
    <td>No</td>
    <td>No</td>
</tr>
<tr>
    <td>Firefox/PC</td>
    <td>Yes</td>
    <td>Yes</td>
</tr>
<tr>
    <td>Firefox/Mac</td>
    <td>Yes</td>
    <td>Yes</td>
</tr>
<tr>
    <td>Safari1.2/Mac</td>
    <td>Yes</td>
    <td>No</td>
</tr>
</table>

<p>If you want to have a play with this yourself, I've zipped up <a href="http://contentwithstyle.pascalopitz.com/resources/ajax-nav/ajax-nav.zip">the whole lot ready for download</a>.</p>
</div>


<div class="comments" id="comments">
    <h2>Comments</h2>
    <ul class="comments-list">
        <li class="odd" id="comment-142">
<div class="comment-text">Fascinating article, Mike. Here&#8217;s a thought: if you allow the href=&#8221;#thing&#8221; to act as a link to a real anchor on the page (so use return true instead of return false) as well as a trigger for the scripting, then the latest version JAWS has a chance of working with your AJAX too.<br />
<br />
So when you make a change to an area of the page you can link to that area and help guide (some) screen readers (indeed all modern browsers) to the new content.</div>
<p class="comment-info">by
<a href="http://www.clagnut.com/" rel="nofollow">Richard Rutter</a> on June 15 2005, 18:12 <a href="#comment-142">#</a>
</p>
</li>
<li class="even" id="comment-143">
<div class="comment-text">Nice thought Richard.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on June 15 2005, 18:40 <a href="#comment-143">#</a>
</p>
</li>
<li class="odd" id="comment-144">
<div class="comment-text">Ah, hadn&#8217;t thought of that! I wonder how hard that would be to add&#8230;? We&#8217;ve got a thing coming up here soon about AJAX and accessibility so I might give it a go then.</div>
<p class="comment-info">by
<a href="http://donotremove.co.uk" rel="nofollow">Mike Stenhouse</a> on June 15 2005, 18:46 <a href="#comment-144">#</a>
</p>
</li>
<li class="even" id="comment-145">
<div class="comment-text">It isn&#8217;t exactly Ajax, but I&#8217;ve been considering doing this for S5 as well.  You can already use fragment identifiers to go straight to a slide, but the address bar doesn&#8217;t change when you move through the slide show.  It&#8217;s been an occasional request, and if I decide to do it, I&#8217;ll definitely look at your code to see how it should be done.  Thanks!</div>
<p class="comment-info">by
<a href="http://meyerweb.com/" rel="nofollow">Eric Meyer</a> on June 15 2005, 19:18 <a href="#comment-145">#</a>
</p>
</li>
<li class="odd" id="comment-146">
<div class="comment-text">Crikey, it&#8217;s the mighty Mr Meyer! You got me into this stuff in the first place&#8230; I think I might owe you a beer.<br />
<br />
I reckon this could have uses outside of AJAX but that&#8217;s just what I happened to be talking about when I came up with the idea, and it stuck. I&#8217;d love to see people put this concept to use elsewhere! Flash seemed like the obvious one, since it&#8217;s asynchronous too, but your S5 app requires the decoupling of the default browser machinery as well, so this might be of some use.</div>
<p class="comment-info">by
<a href="http://donotremove.co.uk" rel="nofollow">Mike Stenhouse</a> on June 15 2005, 19:36 <a href="#comment-146">#</a>
</p>
</li>
<li class="even" id="comment-147">
<div class="comment-text">Mike,<br />
<br />
Thanks, I was in the process of researching all this stuff for my ajax apps.  Prototype (Ajax framework built into RoR) needs this.  I&#8217;ve been working on making prototype fail (ie regular links unless ajax is available) and will think of how to add this as well.</div>
<p class="comment-info">by
<a href="http://overstimulate.com" rel="nofollow">Jesse Andrews</a> on June 16 2005, 05:28 <a href="#comment-147">#</a>
</p>
</li>
<li class="odd" id="comment-149">
<div class="comment-text">This breaks completely if you turn off Javascript.</div>
<p class="comment-info">by
<a href="http://www.firebright.com" rel="nofollow">Jonathan</a> on June 16 2005, 09:40 <a href="#comment-149">#</a>
</p>
</li>
<li class="even" id="comment-150">
<div class="comment-text">Nice stuff. It looks like the code snippets here are wrong though&#8230; take the following code:<br />
<br />
    for(var i=0; i<br />
        var href = links[i].getAttribute(&#8220;href&#8221;);<br />
<br />
There&#8217;s something missing there ;-)<br />
<br />
Also, I don&#8217;t think it&#8217;s a good idea to pass on strings of JavaScript code to PageLocator. You&#8217;d rather write a little wrapper function to execute that code than starting up the JS parser by using `eval`.<br />
<br />
And Jonathan, I don&#8217;t think the app itself will work without JavaScript, so that isn&#8217;t much of a problem.</div>
<p class="comment-info">by
<a href="http://novemberborn.net/" rel="nofollow">Mark Wubben</a> on June 16 2005, 10:29 <a href="#comment-150">#</a>
</p>
</li>
<li class="odd" id="comment-151">
<div class="comment-text">Jonathan: Well duh! :rolleyes:<br />
<br />
It&#8217;s an interesting technique, although I can&#8217;t help thinking there must be an easier way to do it.</div>
<p class="comment-info">by
<a href="http://www.thewatchmakerproject.com/" rel="nofollow">Matthew Pennell</a> on June 16 2005, 10:46 <a href="#comment-151">#</a>
</p>
</li>
<li class="even" id="comment-152">
<div class="comment-text">Damn, I was just working on a demonstration javascript which does exactly that a few days ago to put on my website, but it isn&#8217;t finished yet. So you beat me to it, and that sucks!<br />
<br />
Anyways, a few comments:<br />
 &#8211; It would be easier to use window.location.hash instead of window.location.href;<br />
 &#8211; Instead of loading actual pages with the iframe, you can use iframe.contentWindow.document.open, write and close to achieve the same effect;<br />
 &#8211; And if you use that instead, you can also let it send an event to the script element on load using onload=&#8221;&#8221; or  so you don&#8217;t need the 100ms timeout.<br />
<br />
I don&#8217;t really have time to look into it further now.<br />
<br />
~Grauw</div>
<p class="comment-info">by
<a href="http://www.grauw.nl/" rel="nofollow">Laurens Holst</a> on June 16 2005, 10:51 <a href="#comment-152">#</a>
</p>
</li>
<li class="odd" id="comment-155">
<div class="comment-text">Jonathan: The AJAX-style functionality breaks but a fallback is provided &#8211; the links still go to the content.<br />
<br />
Mark and Laurens: Thanks loads for your input. I&#8217;m neither a JS guru nor an AJAX one; I saw a problem and decided to try and solve it. I really appreciate the input of people who REALLY know the components here.<br />
<br />
Laurens: Sorry mate!</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on June 16 2005, 15:04 <a href="#comment-155">#</a>
</p>
</li>
<li class="even" id="comment-159">
<div class="comment-text">First, for comment 7 (Jonathan) it breaks without js? Wasn&#8217;t AJAX all about js?<br />
(you&#8217;re welcome Mike :)<br />
<br />
The technique is cool , i have been looking into it and still might try my own solution for it someday, still digging into js stuff.<br />
The one thing i didn&#8217;t like was the part that the # makes the page jump to the top again (at least at my first view on FF/Linux). Might be something to look into.<br />
<br />
Other than that, great job.</div>
<p class="comment-info">by
<a href="http://www.mstyle.nl/" rel="nofollow">mstyle</a> on June 17 2005, 01:38 <a href="#comment-159">#</a>
</p>
</li>
<li class="odd" id="comment-160">
<div class="comment-text">I really like the way you have set up this article. How clear can you get writing up where it&#8217;s tested and where it works? By the way, I wouldn&#8217;t mind (and I&#8217;m sure Mike doesn&#8217;t either) feedback and improvements from other configurations than the tested ones. Thinking about the Opera version which supports XmlHttpRequest, is that out properly? I&#8217;ve lost track with Opera, which is a shame. Or any Linux variations. And please no weird hacked or specialized versions. The ones your mum / your client would use is fine. And a cake. And presents. I also wonder what the limitations on Safari are. <br />
I think what Jonathan means, is that if you turn JS off, there is no css loaded with the content when you click on the links. But I think that&#8217;s due to the demo being a demo, or am I wrong?</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Matthias</a> on June 17 2005, 01:59 <a href="#comment-160">#</a>
</p>
</li>
<li class="even" id="comment-161">
<div class="comment-text">Well, I can verify it all works perfectly with Firefox in Linux.</div>
<p class="comment-info">by
<a href="http://emrys.homelinux.net" rel="nofollow">Sam Kaufman</a> on June 17 2005, 02:38 <a href="#comment-161">#</a>
</p>
</li>
<li class="odd" id="comment-162">
<div class="comment-text">Thanks for the killer article man.  I will definitely be integrating this into <a href="http://www.mp3act.net">mp3act.</a> I&#8217;ve been meaning to do that for awhile now and this is a great solution by the looks of it. <br />
<br />
So thanks again, and nice site!  It&#8217;s going into the RSS reader pronto.</div>
<p class="comment-info">by
<a href="http://www.visiblebits.com" rel="nofollow">Jon Buda</a> on June 17 2005, 08:15 <a href="#comment-162">#</a>
</p>
</li>
<li class="even" id="comment-163">
<div class="comment-text">Yay! Lovin&#8217; the over use of the eval statement. <br />
<br />
j00 r0x duD3!</div>
<p class="comment-info">by
<a href="http://notyoursite.com" rel="nofollow">A visitor</a> on June 17 2005, 14:21 <a href="#comment-163">#</a>
</p>
</li>
<li class="odd" id="comment-164">
<div class="comment-text">oooooooooo&#8230; <br />
<br />
eval() is evil!<br />
<br />
DON&#8217;T USE IT EVER&#8230; IT&#8217;S A LAME SOLUTION!</div>
<p class="comment-info">by
another visitor on June 17 2005, 14:54 <a href="#comment-164">#</a>
</p>
</li>
<li class="even" id="comment-165">
<div class="comment-text">Cool, well suggest an alternative and I&#8217;ll pop it in. Mark Wubben spotted the same thing.  As I said earlier, I&#8217;m not a JS guru &#8211; my interest is user experience, so if you know a better way, I&#8217;m all ears.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on June 17 2005, 15:09 <a href="#comment-165">#</a>
</p>
</li>
<li class="odd" id="comment-166">
<div class="comment-text">@all the eval haters:
<br />
I don&#8217;t think eval used on the client side is a big issue, unlike the server side when input variables are evaluated. So I don&#8217;t agree with the statement that eval is a lame solution.
<br />
What's the worst thing that could happen? Since anyone can read the source and all the data is already passed to the browser it would be possible to execute anything through <code>javascript:doWhatIWant(with.myObject)</code> anyway ...
<br />

If you want to make the thing &#8220;secure&#8221; than check the propertyToUse against a list of allowed properties.

<br />
<br />

When we move to PHP code that&#8217;s a different story. In general you should always make sure that gets fed into a string which will be parsed by eval CANNOT contain anything malicious.<br />
<br />
&#8220;Never trust any user input!&#8221; </div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on June 17 2005, 15:29 <a href="#comment-166">#</a>
</p>
</li>
<li class="even" id="comment-167">
<div class="comment-text">Well&#8230;besides precious time and client-side processor-load, ... what IS the worst thing that could happen?</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Matthias</a> on June 18 2005, 23:34 <a href="#comment-167">#</a>
</p>
</li>
<li class="odd" id="comment-168">
<div class="comment-text">Eval isn&#8217;t the fastest thing since slicest bread, you might as well want to avoid it if that&#8217;s possible. Anyway, Mike, I already suggested a solution :) Here it is again, but with a code example:<br />
<br />
     this.locator = new PageLocator(function(){return window.location.href}, &#8221;#&#8221;);<br />
<br />
Inside PageLocator you simply execute the passed function, and you get the value.</div>
<p class="comment-info">by
<a href="http://novemberborn.net/" rel="nofollow">Mark Wubben</a> on June 19 2005, 15:34 <a href="#comment-168">#</a>
</p>
</li>
<li class="even" id="comment-169">
<div class="comment-text">@Mark: good suggestion, and yeah, definetly eval isn&#8217;t the FASTEST thing, so yeah, avoid it if possible &#8230; But the script doesn&#8217;t loop-execute a thousand evals, so I just don&#8217;t see the massive impact the one single use of eval would have had &#8230; I just don&#8217;t see where eval is EVIL &#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on June 20 2005, 02:49 <a href="#comment-169">#</a>
</p>
</li>
<li class="odd" id="comment-171">
<div class="comment-text">Eval has some necessary uses, though it&#8217;s slow because the parser has to go over each eval line twice: once to evaluate the statement, and once to execute it. Not a huge problem for small scripts, but not the most elegant solution either. I use eval sometimes to escape function literals (var foo = function(){/* bar */};) because they cause syntax errors in some older (now ancient) browsers. <br />
<br />
However, in your case, if you just need to evaluate a string as a variable name, why not use a string index of an associative array?<br />
<br />
if(this.validProperties[propertyToUse]){<br />
  return this.validProperties[propertyToUse]<br />
}</div>
<p class="comment-info">by
<a href="http://cookiecrook.com/" rel="nofollow">James Craig</a> on June 21 2005, 17:25 <a href="#comment-171">#</a>
</p>
</li>
<li class="even" id="comment-172">
<div class="comment-text">Thanks for the snippet Mark &#8211; I really like that idea. I&#8217;ve been using the same method in some code I&#8217;ve been writing recently but I&#8217;d not made the connection back to this example. I would have made the changes the first time you posted but I&#8217;ve been incredibly busy&#8230;<br />
<br />
Thanks also to James. I&#8217;ve always tried to avoid eval but it&#8217;s been so long that I&#8217;d actually forgotten why. The reason I used it here is because I couldn&#8217;t think of a way to make the wrapper flexible enough to monitor a variety of properties. I have a tendency to get hung up on code flexibility&#8230; There&#8217;s an interesting article on exactly that by Marcus Baker in PHP Architect from back in February.</div>
<p class="comment-info">by
<a href="http://donotremove.co.uk" rel="nofollow">Mike Stenhouse</a> on June 21 2005, 18:38 <a href="#comment-172">#</a>
</p>
</li>
<li class="odd" id="comment-174">
<div class="comment-text">Good article Mike.<br />
<br />
If only Opera could fix their document.location bugs already.<br />
<br />
And yes, eval is evil. Any time you see it you should ask yourself why? The only valid reason to use it is to allow a user to enter code that you want to evaluate. In your case it seems what you want to pass as an argument is the location object (or as previously suggested a function returning the object in question).</div>
<p class="comment-info">by
<a href="http://erik.eae.net" rel="nofollow">Erik Arvidsson</a> on June 21 2005, 23:08 <a href="#comment-174">#</a>
</p>
</li>
<li class="even" id="comment-175">
<div class="comment-text">This is a very classy solution, I like it. <br />
<br />
I wonder if someone could make a GMaps implementation where each drag results in a &#8216;reload&#8217; to the same page, but with javascript that scoops up the request, contained entirely in the #clause, and re-find the location&#8230; ???</div>
<p class="comment-info">by
<a href="http://uwmike.com" rel="nofollow">Mike Purvis</a> on June 23 2005, 06:40 <a href="#comment-175">#</a>
</p>
</li>
<li class="odd" id="comment-176">
<div class="comment-text">Excelent Solution!!!</div>
<p class="comment-info">by
<a href="http://www.ig2producciones.com.ar" rel="nofollow">Ignacio</a> on June 23 2005, 17:53 <a href="#comment-176">#</a>
</p>
</li>
<li class="even" id="comment-177">
<div class="comment-text">Mike: That&#8217;s exactly what I&#8217;d like to see! The reason I did this in the first place was because Google Maps wasn&#8217;t easily bookmarkable&#8230; Maybe a Greasemonkey script?</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on June 23 2005, 20:41 <a href="#comment-177">#</a>
</p>
</li>
<li class="odd" id="comment-178">
<div class="comment-text">This demo (the download able) doesn&#8217;t work for me. The test.php is missing. Maybe I understood something wrong?</div>
<p class="comment-info">by
Vert on June 28 2005, 09:26 <a href="#comment-178">#</a>
</p>
</li>
<li class="even" id="comment-179">
<div class="comment-text">Sorry about that Vert &#8211; don&#8217;t know when or why I removed test.php from the zip. It&#8217;s back in now so give it another go&#8230;</div>
<p class="comment-info">by
<a href="http://donotremove.co.uk" rel="nofollow">Mike Stenhouse</a> on June 29 2005, 02:22 <a href="#comment-179">#</a>
</p>
</li>
<li class="odd" id="comment-180">
<div class="comment-text">I must be the only mac user to post.  The script doesn&#8217;t seem to work on either Safari or IE5 for me.  <br />
In safari, the address bar does what it should do, and I can use the back button the way you intended it to be used.  However, the content on the page does not revert to previous states when the back button is pressed.<br />
On IE, the script works, but clicking on the side nav seems to dissacociate the page from it&#8217;s stylesheet,</div>
<p class="comment-info">by
Sholom on June 30 2005, 09:16 <a href="#comment-180">#</a>
</p>
</li>
<li class="even" id="comment-182">
<div class="comment-text">The script doesn&#8217;t work in iE/Mac &#8211; I&#8217;ve stopped developing for it as of this year. It&#8217;s usage for the sites I work on has dropped below the 1% threshold. When you click on the links you are taken to the static version of the content, generated server side, which I&#8217;ve not styled.<br />
<br />
This did work on Safari 1.2 but I&#8217;ve not tried it on the newest release. Well, I say work&#8230; See the browser support table at the end of the article. Bookmarking worked but the back button remained broken. Maybe 1.3 has changed something&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on June 30 2005, 16:00 <a href="#comment-182">#</a>
</p>
</li>
<li class="odd" id="comment-184">
<div class="comment-text">I say eval() is a necessary evil since Javascript has almost no support for reflection. (No way to dynamically call functions, dynamically assign variables, etc.)</div>
<p class="comment-info">by
<a href="http://hao2lian.f2o.org/ploidy/" rel="nofollow">hao2lian</a> on July 2 2005, 04:23 <a href="#comment-184">#</a>
</p>
</li>
<li class="even" id="comment-186">
<div class="comment-text">Good work Mike, this has been an issue of mine for the MP3 site &#8211; i&#8217;ll be in touch. Glad to also hear your thoughts on IE Mac &#8211; i&#8217;ve been trying to (unsucessfully) steer clients in that direction. Easy&#8230;</div>
<p class="comment-info">by
<a href="http://www.anyoldshit.com" rel="nofollow">Mr Spooner</a> on July 8 2005, 16:39 <a href="#comment-186">#</a>
</p>
</li>
<li class="odd" id="comment-187">
<div class="comment-text">I wrote my script mostly from scratch, but I got the concept from here, I think it&#8217;s a little simpler than yours, and may have a few better methods. <a href="http://www.chudosok.info/21/">chudosok.info 2.1</a><br />
Any comments or suggestions?</div>
<p class="comment-info">by
Nobody on July 9 2005, 06:55 <a href="#comment-187">#</a>
</p>
</li>
<li class="even" id="comment-190">
<div class="comment-text">Hi. This leads me to wonder if the same solution can be used for solving similar problems for frames which more or less achieve the same thing if you are just using ajax for bringing in a navigation bar that doesn&#8217;t keep refreshing.</div>
<p class="comment-info">by
jw on July 16 2005, 03:51 <a href="#comment-190">#</a>
</p>
</li>
<li class="odd" id="comment-191">
<div class="comment-text">In comment 7, Jonathan made an important point, this completely breaks if JS is turned off, the point is important because it does not have to break!<br />
<br />
in the links pointing to content.php you can add a parameter to the url  hash=n&#38;nojs=true, in php if you see this parameter you also include the header and footer of the page, this way people who have js disabled will be loading content.php the old way AND getting the same page (with the black strips on top and bottom) ,  for people with JS enabled the href is rewritten using javascript (removing the nojs=true and using the # hack) and they will use ajax just like they are doing now!<br />
<br />
I hope this was clear enough!</div>
<p class="comment-info">by
Pat on July 21 2005, 09:11 <a href="#comment-191">#</a>
</p>
</li>
<li class="even" id="comment-192">
<div class="comment-text">I think I see what you mean Pat. As it is, if you turn off your JS, go to the demo and click the links they will still bring back your content, via a separate page that uses the same content-generating class server side but without any styling. I didn&#8217;t hook that page up to my CSS because my interest lay with the front end and the usability problem presented&#8230; It&#8217;s a separate page so there&#8217;s no need to pass in extra querystring params. To be honest, the server side bit isn&#8217;t very elegant but my main focus was the front end.<br />
<br />
There are enough great suggestions here to warrant an upgrade to the article but I just haven&#8217;t had time to do it, although Nobody (35) may have beaten me to it anyway!</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on July 22 2005, 02:10 <a href="#comment-192">#</a>
</p>
</li>
<li class="odd" id="comment-193">
<div class="comment-text">If someone could tell me where I can find the Ajax part please do, but this has nothing todo with Ajax. Do not want to be offence, but this solution is a definite no go when utilizing xmlHttpRequest. Good for making ignorant people all excited but also only usefull if you can really set a history object with an iframe and totally not useless in a so called Ajax application.<br />
<br />
There is no fix, and it is technically impossible within current browsers. The use of Ajax on the frontend is the only thing that is wrong. People use it in the wrong way.<br />
<br />
Use it because you need it, not because it is cool.</div>
<p class="comment-info">by
M. Schopman on July 22 2005, 21:56 <a href="#comment-193">#</a>
</p>
</li>
<li class="even" id="comment-194">
<div class="comment-text">Mr. Schopman, I think you didn&#8217;t propperly take time understand the scope of this article. Mike is not coding an AJAX application here, but pointing out a possible solution for a common problem occurring with AJAX applications.<br />
This has nothing to do with beeing cool but is an approach for all those who do use AJAX but find that the back button isn&#8217;t just a useless thing in the top corner of the browser.<br />
<br />
Whether people that are actually building AJAX applications and maybe incorporating this solution into their AJAX application are ignorant this might be your point of view, but we don&#8217;t necessarily agree with you at that point.<br />
<br />
However, the only useful points you really made are<br />
<br />
a) You should use things because they make sense<br />
b) You might not be able to use an iframe in your application, therefore the solution mike suggested could not be for you<br />
<br />
<em>To all other posters in here, please watch your tone, I don&#8217;t think it&#8217;s necessary to be as impolite as Mr Schopman. We are no big fans of editing user comments, but we are no big fans of a rude tone either</em></div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on July 23 2005, 16:08 <a href="#comment-194">#</a>
</p>
</li>
<li class="odd" id="comment-197">
<div class="comment-text">Yep, as Pascal said, this article is less about AJAX itself and more about usability. If anyone needs a reality check on AJAX and its related technologies I highly recommend Marcus Baker&#8217;s article <a href="http://www.lastcraft.com/blog/index.php?p=19">Listen kids, AJAX is not cool</a>.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on July 25 2005, 17:00 <a href="#comment-197">#</a>
</p>
</li>
<li class="even" id="comment-199">
<div class="comment-text">When I go to the demo page, http://contentwithstyle.pascalopitz.com/resources/ajax-nav/#1, I get errors in a dialog saying only Only variables should be assigned by reference etc. in both IE and FireFox. Any ideas?</div>
<p class="comment-info">by
<a href="http://notavailable.com" rel="nofollow">tester</a> on July 27 2005, 18:38 <a href="#comment-199">#</a>
</p>
</li>
<li class="odd" id="comment-200">
<div class="comment-text">Hi tester.<br />
<br />
This is a problem with JPSpan and PHP 4.4. My hosting provider just upgraded from 4.x to 4.4, therefore the unexpected error.<br />
<br />
We&#8217;ll fix that ASAP.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on July 28 2005, 18:26 <a href="#comment-200">#</a>
</p>
</li>
<li class="even" id="comment-201">
<div class="comment-text">Hi,<br />
<br />
Thanks for writing fix for back button problem with AJAX.<br />
<br />
Well, i am trying to fix this problem by utilising your code but I am not using JPSPAN function for AJAX. I am simply using XMLHTTP object and its function to make request to my server side php and getting html data ( i don&#8217;t need xml data).<br />
<br />
I am not sure whether your fix will work for all the AJAX code. But i will appreciate if you change it to be compatible and generic for all AJAX. As of now, with your scripts I am totally confused to use what and where? Can you please write a small paragraph on how to plug this into any AJAX code. I am not JS expert nor I am AJAX expert.<br />
<br />
And I do have real time monitoring system which uses ajax and in my page there are four frames which are requesting to server and loading data in real time.<br />
<br />
Any help in this will be greatly appreciated.<br />
<br />
Cheers!</div>
<p class="comment-info">by
Dipesh on July 29 2005, 00:59 <a href="#comment-201">#</a>
</p>
</li>
<li class="odd" id="comment-202">
<div class="comment-text">The bits of the code that call the back-end are &#8216;function doGetPage(i)&#8217; and &#8216;var PageHolderHandler&#8217;. I&#8217;ve not looked into exactly how they&#8217;re hooked up to my PHP &#8211; I&#8217;ve let the magic of <a href="http://jpspan.sourceforge.net/wiki/doku.php">JPSpan</a> take care of that for me. If your code is OO then I highly recommend JPSpan &#8211; it exposes your server-side methods to your client side code in a matter of minutes&#8230;<br />
<br />
You say you have 4 frames&#8230; Do you mean frames, as in the HTML element? That might break my fix since I use an iFrame exploit to get the whole thing working in IE.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on July 29 2005, 01:58 <a href="#comment-202">#</a>
</p>
</li>
<li class="even" id="comment-203">
<div class="comment-text">Hi Mike,<br />
Thanks for responding and informing me about the firing methods.<br />
<br />
Well, I will try to use that into my code and see whether I can use it or not.<br />
<br />
Yes, i do have 4 frames (html) element in my page and each of them is auto refreshing. Out of these one is hidden (triggering frame) and other three are data pulling frames from the server.<br />
<br />
Well I am trying to support my application on FF first and if that works then 90% work done. <br />
<br />
Thanks once again.<br />
<br />
Cheers!<br />
Dipesh</div>
<p class="comment-info">by
Dipesh on July 29 2005, 19:17 <a href="#comment-203">#</a>
</p>
</li>
<li class="odd" id="comment-204">
<div class="comment-text">If you want, Dipesh, you can look at the source code on <a href="http://www.chudosok.info/21">chudosok</a> It uses pure XMLHTTPRequest for getting back html.</div>
<p class="comment-info">by
Nobody on July 31 2005, 04:07 <a href="#comment-204">#</a>
</p>
</li>
<li class="even" id="comment-205">
<div class="comment-text">The problem with <a href="http://www.donotremove.co.uk/extra/ajax-nav/">http://www.donotremove.co.uk/extra/ajax-nav/</a> is that you can&#8217;t open in new window in Internet Explorer and it won&#8217;t work at all in Opera. <a href="http://www.chudosok.info/21">chudosok</a> works in all except if you browse too fast in Opera. It&#8217;d be nice if you tried some of my code.</div>
<p class="comment-info">by
Nobody on July 31 2005, 04:23 <a href="#comment-205">#</a>
</p>
</li>
<li class="odd" id="comment-206">
<div class="comment-text">One more thing, I don&#8217;t want to say I&#8217;m better, after all I did get the idea from you. Thanks.</div>
<p class="comment-info">by
Nobody on July 31 2005, 04:25 <a href="#comment-206">#</a>
</p>
</li>
<li class="even" id="comment-208">
<div class="comment-text">No offense taken! I look forward to examining your method when I&#8217;ve got a little more time&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on August 1 2005, 15:28 <a href="#comment-208">#</a>
</p>
</li>
<li class="odd" id="comment-210">
<div class="comment-text">Hi Nobody,<br />
<br />
Well i tried to go to your site to see the generic solution. Is your site in some different language, i can&#8217;t understand those language ? I went to the following site:<br />
<br />
http://www.chudosok.info/21/<br />
<br />
My problem is with the back button, i have already created real time monitoring system using AJAX. <br />
<br />
Looking forward to hear from you.<br />
<br />
Cheers!</div>
<p class="comment-info">by
Dipesh on August 1 2005, 22:51 <a href="#comment-210">#</a>
</p>
</li>
<li class="even" id="comment-211">
<div class="comment-text">The site is in Russian, but the javascript isn&#8217;t, lol. The information on the website has nothing to do with ajax, but it loads the data via ajax and also supports the back button. I&#8217;m saying you can take the source if you like, sorry that&#8217;s it&#8217;s not commented though.<br />
<br />
God Bless.</div>
<p class="comment-info">by
Nobody on August 2 2005, 02:25 <a href="#comment-211">#</a>
</p>
</li>
<li class="odd" id="comment-212">
<div class="comment-text">Ok, I made a cut-down, half-English, commented version to make it easier on you.<br />
<a href="http://www.chudosok.info/commented/">http://www.chudosok.info/commented/</a></div>
<p class="comment-info">by
Nobody on August 2 2005, 03:43 <a href="#comment-212">#</a>
</p>
</li>
<li class="even" id="comment-213">
<div class="comment-text">Hi Mike<br />
<br />
The code fix is good and would do the job for simple pages. The way I have written my ajax application is that it has a mvc pattern on the browser tier and performs view rendering on the client.<br />
this should have been &#8221; backable &#8221; using ur style but the issue we face is with handling multiple views.. <br />
a user interaction triggers view updates in multiple views on the page. so a back button click or a bookmark operation would involve remembering the state of all the views.<br />
any ideas on such a scenario..</div>
<p class="comment-info">by
shashank on August 2 2005, 10:58 <a href="#comment-213">#</a>
</p>
</li>
<li class="odd" id="comment-214">
<div class="comment-text">hi,<br />
<br />
Thanks for replying and putting commented files on your site. Greatly appreciated.<br />
<br />
It is still customized to your page, (it has all the elements which you have created in your html) and it is  tailored like that. I am not JS expert, but as far as I could make out, following javascript  functions must be related to page history :<br />
<br />
1) chkURL() &gt; This function you must be calling on load. Am i right ? This is so that it can check the URL and store it.<br />
<br />
2) getPageN() > Get this page number from the history?<br />
<br />
3) getPageName() &gt; This is for your contact page thing?<br />
<br />
4) getPage() > requesting this page and displaying it in the browser?<br />
<br />
Well, the major problem which i see in using this is  I am using 4 frames. There is no event based display of the pages, I am refreshing screen if something is happening at the back end and displaying it to the client. For this I have 4 frames in the page, which has different data and I am updating this data. <br />
<br />
Does your solution still fits into my architecture?<br />
<br />
Thanks once again for writing commented version of your code.<br />
<br />
Regards,<br />
Dipesh</div>
<p class="comment-info">by
Dipesh on August 2 2005, 19:58 <a href="#comment-214">#</a>
</p>
</li>
<li class="even" id="comment-215">
<div class="comment-text">chkURL() is a like a timer loop that checks whether or not the url has changed, historywise or not. It is started up 100 milliseconds after load. The extra ie.htm and ie.js help Internet Explorer change the url when the back or forward button is clicked.<br />
<br />
getPageN() is fired on url change, which checks if the url is valid, then tells getPage() which page to load and display.<br />
<br />
getPageName() disects the url to get the name of the page. This is used for loading the needed page, for checking whether the url has changed, etc.<br />
<br />
True,<br />
function getPageName() is invloved in the history.<br />
function chkURL() is one of the main functions involved in history, but also in navigating by links.<br />
<br />
var lastURL stores the last url to check against when navigating.<br />
<br />
ie.js and ie.htm which are included in this manner:<br />
<br />
and fired at startup like:<br />
</div>
<p class="comment-info">by
Nobody on August 3 2005, 00:16 <a href="#comment-215">#</a>
</p>
</li>
<li class="odd" id="comment-216">
<div class="comment-text">oops, part of my post got cut off because of the tag stuff<br />
<br />
chkURL() is a like a timer loop that checks whether or not the url has changed, historywise or not. It is started up 100 milliseconds after load. The extra ie.htm and ie.js help Internet Explorer change the url when the back or forward button is clicked.<br />
<br />
getPageN() is fired on url change, which checks if the url is valid, then tells getPage() which page to load and display.<br />
<br />
getPageName() disects the url to get the name of the page. This is used for loading the needed page, for checking whether the url has changed, etc.<br />
<br />
True,<br />
function getPageName() is invloved in the history.<br />
function chkURL() is one of the main functions involved in history, but also in navigating by links.<br />
<br />
var lastURL stores the last url to check against when navigating.<br />
<br />
ie.js and ie.htm which are included in this manner:<br />
    {!&#8212;[if IE]}<br />
    {script type=&#8221;text/javascript&#8221; src=&#8221;ie.js&#8221;}{/script}<br />
    {![endif]&#8212;}<br />
and fired at startup like:<br />
{body onload=&#8221;try{if(ieLoader){ieLoader();}}catch(e){}...<br />
<br />
just replace {}  with the the tag thingies<br />
<br />
are required for it to function in Internet Explorer and are only for history, so all the functions there are for history.<br />
<br />
I think what you&#8217;re doing is similar to how gmail auto-updates the user&#8217;s inbox. If you need people to navigate back in your app, this wil work. All you need is to have people navigate by page.htm#wheretogo and have the chkURL() fire a function to deal with the wheretogo when it changes.<br />
<br />
And you&#8217;re welcome.</div>
<p class="comment-info">by
Nobody on August 3 2005, 00:21 <a href="#comment-216">#</a>
</p>
</li>
<li class="even" id="comment-226">
<div class="comment-text">doesnt&#8217; works for opera 8 browser :/</div>
<p class="comment-info">by
<a href="http://darklife.zoomblog.com" rel="nofollow">Xavier</a> on August 29 2005, 09:06 <a href="#comment-226">#</a>
</p>
</li>
<li class="odd" id="comment-228">
<div class="comment-text">>doesnt&#8217; works for opera 8 browser :/<br />
<br />
Mine or Mike&#8217;s?</div>
<p class="comment-info">by
Nobody on August 30 2005, 18:29 <a href="#comment-228">#</a>
</p>
</li>
<li class="even" id="comment-250">
<div class="comment-text">&#8212;> doesn&#8217;t work if you turn Javascript off<br />
<br />
so when are people going to stop saying this about AJAX stuff? You know Async JAVASCRIPT and XML?<br />
<br />
We know that AJAX stuff doesn&#8217;t work if Javascript is turned off. WE KNOW.<br />
<br />
If Javascript isn&#8217;t turned off then we don&#8217;t need to worry about bookmarking where we are in an AJAX app do we?<br />
<br />
Sorry&#8230;just tired of seeing that comment EVERYWHERE.</div>
<p class="comment-info">by
<a href="http://www.clearnova.com" rel="nofollow">Steve</a> on September 28 2005, 20:22 <a href="#comment-250">#</a>
</p>
</li>
<li class="odd" id="comment-275">
<div class="comment-text">&#8220;What can be changed in the URL that won&#8217;t trigger a page reload? The hash portion.&#8221;<br />
<br />
Brilliantly simple.  Genius, even.  Thanks for the great article!</div>
<p class="comment-info">by
James on October 20 2005, 05:20 <a href="#comment-275">#</a>
</p>
</li>
<li class="even" id="comment-277">
<div class="comment-text">@Nobody &#8211; Could you please show the code for the /commented/data.php file.</div>
<p class="comment-info">by
<a href="http://elixirpc.net" rel="nofollow">Gavin</a> on October 23 2005, 20:25 <a href="#comment-277">#</a>
</p>
</li>
<li class="odd" id="comment-281">
<div class="comment-text">Mike:<br />
<br />
The error:<br />
<br />
[Server+Error][2000] Only variables should be assigned by reference<br />
Method called: pageholder.as html()<br />
<br />
still exists, even though it was committed to being fixed back in July (ref. comments 42 and 43).<br />
<br />
I would really be interested in looking at this as I have an urgent need for some reasonably way of handling the back button issue, even if it&#8217;s not perfect.<br />
<br />
Any chance this can be addressed in the very near future?<br />
 &#8211; Thanks!<br />
<br />
Jim</div>
<p class="comment-info">by
Jim on October 27 2005, 04:50 <a href="#comment-281">#</a>
</p>
</li>
<li class="even" id="comment-282">
<div class="comment-text">It actually was fixed! That error is due to some changes in PHP4.40 that have affected the version of JPSPAN that I&#8217;m using. I moved the demo to my webhost that until this week was running on PHP4.3 but it looks like they&#8217;ve now upgraded. I&#8217;ll fix it AGAIN. Sorry for any delay Jim.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on October 27 2005, 06:41 <a href="#comment-282">#</a>
</p>
</li>
<li class="odd" id="comment-283">
<div class="comment-text">Right, I&#8217;ve moved the demo to my dev server so it&#8217;s up and running again, this time under PHP5. There is a bug report on the JPSPAN sourceforge page about the PHP4.4.0 problem but nothing&#8217;s been done about it yet. I guess Harry&#8217;s busy&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on October 27 2005, 08:42 <a href="#comment-283">#</a>
</p>
</li>
<li class="even" id="comment-284">
<div class="comment-text">Mike:<br />
<br />
Thank you!<br />
<br />
I have scoured the web and yours seems the most viable solution.<br />
<br />
Those of us serious about using modern technologies in our dynamically generated web apps must have a reliable way of dealing with the legacy issues that will always be with us &#8211; those  left over from the days when all web pages were static.<br />
<br />
I am most anxious to view/study your solution.<br />
<br />
Thanks, again.<br />
<br />
Jim</div>
<p class="comment-info">by
Jim on October 27 2005, 13:32 <a href="#comment-284">#</a>
</p>
</li>
<li class="odd" id="comment-285">
<div class="comment-text">Mike:<br />
<br />
Can you share what the PHP 4.4.0 fix is?<br />
<br />
Thank you.<br />
<br />
(You&#8217;re right about Harry. Haven&#8217;t seen him any of the usual places for a very long time.)<br />
<br />
Jim</div>
<p class="comment-info">by
Jim on October 27 2005, 22:07 <a href="#comment-285">#</a>
</p>
</li>
<li class="even" id="comment-286">
<div class="comment-text">Jim, if you look up the comments a bit you&#8217;ll see a link from a chap calling himself &#8216;Nobody&#8217; to an implementation he&#8217;s come up with. He says it&#8217;s simpler than mine but I just haven&#8217;t had the time to dissect it myself. Might be worth a look if you&#8217;re starting from scratch though&#8230;<br />
<br />
From what I can gather the good folk behind PHP have decided to tighten up their pass-by-reference handling and creating new objects. I don&#8217;t know the ins and outs of it to be honest. I had several days of listening to Marcus complain about the changes he was having to make to <a href="http://www.simpletest.org">SimpleTest</a> but that&#8217;s about my lot! There&#8217;s a decent explanation on SitePoint though: <a href="http://www.sitepoint.com/blogs/2005/07/30/php-44-minor-gotcha/">PHP 4.4 Minor Gotcha</a>. Hope that helps&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on October 28 2005, 08:41 <a href="#comment-286">#</a>
</p>
</li>
<li class="odd" id="comment-287">
<div class="comment-text">Mike:<br />
<br />
Interesting reading. Thanks for the link.<br />
 &#8211; Thanks!</div>
<p class="comment-info">by
Jim on October 28 2005, 17:36 <a href="#comment-287">#</a>
</p>
</li>
<li class="even" id="comment-288">
<div class="comment-text">> Could you please show the code for the /commented/data.php file.<br />
<br />
Sorry, I&#8217;ve been gone for ages, here&#8217;s the content in data.php: <a href="http://www.chudosok.info/commented/data_php.txt">http://www.chudosok.info/commented/data_php.txt</a></div>
<p class="comment-info">by
Nobody on October 29 2005, 17:52 <a href="#comment-288">#</a>
</p>
</li>
<li class="odd" id="comment-337">
<div class="comment-text">This method works okey for me, but when i try to include something more than a plain text in &#8216;pageholder.class.php&#8217;  gives me problems. <br />
<br />
    I can&#8217;t include into this class complete pages becoming of every directory. Do everybody know how to fix this problem?</div>
<p class="comment-info">by
peter on November 21 2005, 11:54 <a href="#comment-337">#</a>
</p>
</li>
<li class="even" id="comment-347">
<div class="comment-text">Thanks for this.  I will have to adapt this to my AJAX app .  At this time I only have one link that allows outside linking.  I don&#8217;t know if I will implement the support for non javascript seeing as without it my app is no good anyway.</div>
<p class="comment-info">by
<a href="http://www.coder2000.com/trucker/" rel="nofollow">Coder2000</a> on November 30 2005, 16:43 <a href="#comment-347">#</a>
</p>
</li>
<li class="odd" id="comment-349">
<div class="comment-text">Hi, nice article. I just want you to now there is this really_simple_history_framework that I use and seems to be working pretty cool. http://codinginparadise.org/projects/dhtml_history/README.html<br />
I think the approach is the same as what you do, but you mught find it interesting to check out.<br />
<br />
kind regards.</div>
<p class="comment-info">by
<a href="http://jokerwebs.com" rel="nofollow">Rik</a> on December 2 2005, 06:52 <a href="#comment-349">#</a>
</p>
</li>
<li class="even" id="comment-350">
<div class="comment-text">The bookmarking system described here works only for javascript-enabled browser. If you follow the #-kind-of-link in the browser without javascript, the result will be weird.<br />
<br />
Is there a way to get access to the hash portion of the url from server? If it&#8217;s possible we could fix the problem&#8230;</div>
<p class="comment-info">by
colobot on December 5 2005, 09:38 <a href="#comment-350">#</a>
</p>
</li>
<li class="odd" id="comment-351">
<div class="comment-text">Is this method also applicable for DOM scripts eg a toggle which relies on #hash links that  show/hide a div container.The hashlinks which toggle the on/off state are not visible in the actual addressbar either.</div>
<p class="comment-info">by
repeater on December 5 2005, 19:19 <a href="#comment-351">#</a>
</p>
</li>
<li class="even" id="comment-352">
<div class="comment-text">I&#8217;m using js link a bit differently<br />
<br />
[a href=&#8221;some.link&#8221; onclick=&#8221;goUrl(&#8216;some.link&#8217;);return false;&#8221;]Some Link[/a]<br />
<br />
In this way there is a fallback/failover suport if js is disabled.<br />
<br />
My problems are <br />
1. back button<br />
2. bookmarking current page<br />
<br />
How do you suggest to address this case ? Do you thing I can adjust your solution to my problem ?<br />
<br />
Thanks,<br />
MC<br />
www.goodstockimages.com<br />
<br />
Ps.<br />
BTW I&#8217;m using AjaxAnywhere  http://ajaxanywhere.sourceforge.net/</div>
<p class="comment-info">by
<a href="http://goodstockimages.com" rel="nofollow">MC</a> on December 7 2005, 13:21 <a href="#comment-352">#</a>
</p>
</li>
<li class="odd" id="comment-353">
<div class="comment-text">wow&#8230; amazing&#8230; I&#8217;ve looking for this and now&#8230; I understand it&#8230; thanks.<br />
<br />
just a brazilian newbie.</div>
<p class="comment-info">by
Juan Hafliger on December 11 2005, 06:33 <a href="#comment-353">#</a>
</p>
</li>
<li class="even" id="comment-358">
<div class="comment-text">FYI &#8211; There has been a really nice implementation of this approach by a big company.  Yahoo! has done this well with their new <a href="http://maps.yahoo.com/beta/">maps beta</a>.  The maps (using flash) are very dynamic but the url always remains accurate and &#8220;cut and pasteable&#8221; via use of the hash.</div>
<p class="comment-info">by
<a href="http://breasy.com/blog/" rel="nofollow">Udi Falkson</a> on December 22 2005, 17:26 <a href="#comment-358">#</a>
</p>
</li>
<li class="odd" id="comment-355">
<div class="comment-text">@MC<br />
<br />
Just make you js link do &#8220;window.location.href = &#8217;#lalala&#8217;;&#8221;<br />
<br />
So, it will still do the navigating thing.</div>
<p class="comment-info">by
Nobody on December 14 2005, 23:12 <a href="#comment-355">#</a>
</p>
</li>
<li class="even" id="comment-357">
<div class="comment-text">I want to develop a search results page, in which i want to display the results depends on price. I want to use one slider which contains the price range. when the user drag this slider,  i have to display the results in this price range only.</div>
<p class="comment-info">by
venkat on December 21 2005, 08:21 <a href="#comment-357">#</a>
</p>
</li>
<li class="odd" id="comment-361">
<div class="comment-text">A bit off topic, but I&#8217;m developing a file manager which has file searches which get posted from a form. I then use window.location.href or window.location.hash to write the search string to the URL. This works fine, except in Safari, where the page goes into a permanent &#8216;Loading&#8217; state. Any ideas?</div>
<p class="comment-info">by
Jeff P on December 29 2005, 03:49 <a href="#comment-361">#</a>
</p>
</li>
<li class="even" id="comment-362">
<div class="comment-text">Man I LOVE YOU !!! Thanks for the this great article !</div>
<p class="comment-info">by
danux on December 29 2005, 08:39 <a href="#comment-362">#</a>
</p>
</li>
<li class="odd" id="comment-367">
<div class="comment-text">This solution is right but still not 100% because in IE it doesnt let you change the hash programmaticly . <br />
<br />
check erik.eae.net/playground/hashlistener.zip for the solution</div>
<p class="comment-info">by
Tastaturbeschmutzer on January 9 2006, 17:06 <a href="#comment-367">#</a>
</p>
</li>
<li class="even" id="comment-373">
<div class="comment-text">Hi,<br />
I&#8217;m the admin of the opensource project &#8220;thephpbible.sourceforge.net&#8221;<br />
thephpbible  allows webdesigners to quickly and easily integrate a simple Bible into their church or organizations web site.<br />
We need someone to add this functionality to our project.<br />
If anyone is interested contact me (bywave AT gmail.com)<br />
<br />
Thanks</div>
<p class="comment-info">by
<a href="http://bywavelabs.com/thephpbible/" rel="nofollow">thephpbible</a> on January 16 2006, 02:57 <a href="#comment-373">#</a>
</p>
</li>
<li class="odd" id="comment-389">
<div class="comment-text">hey there tastatureschmutzer<br />
<br />
excellent work. i got yours working on firefox on mac with ease. how do you get it working on a pc running internet explorer. <br />
<br />
great stuff.</div>
<p class="comment-info">by
<a href="http://www.autonomi.net" rel="nofollow">autonomous019</a> on January 27 2006, 12:08 <a href="#comment-389">#</a>
</p>
</li>
<li class="even" id="comment-421">
<div class="comment-text">Has anyone got this working with flash yet? we flash guys really need these basic browser functions</div>
<p class="comment-info">by
Gareth on February 6 2006, 17:25 <a href="#comment-421">#</a>
</p>
</li>
<li class="odd" id="comment-422">
<div class="comment-text">This has been done with Flash before, but this article is specifically about doing it with the XMLHttpRequest object.</div>
<p class="comment-info">by
Nobody on February 6 2006, 21:24 <a href="#comment-422">#</a>
</p>
</li>
<li class="even" id="comment-423">
<div class="comment-text">It already is possible in Flash &#8211; that&#8217;s where I got the basic technique from! For an example of it in action see the <a href="http://www.holler.co.uk">Holler</a> site&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on February 7 2006, 06:47 <a href="#comment-423">#</a>
</p>
</li>
<li class="odd" id="comment-424">
<div class="comment-text">The Holler site only seems to address the back button issue in Flash, though, not bookmarking. Robert Penner&#8217;s solution also doesn&#8217;t support bookmarking (unless I&#8217;m missing something). Perhaps it would be worthwhile to change the &#8220;The original bookmark/back button fix, as used by Flash developers for a little while now&#8221; phrase in the article to only mention the back button? Sorry if I&#8217;m wrong about any of this.<br />
<br />
Thanks.</div>
<p class="comment-info">by
b on February 7 2006, 18:55 <a href="#comment-424">#</a>
</p>
</li>
<li class="even" id="comment-426">
<div class="comment-text">You might want to have a look at the source of the <a href="http://www.redbulltrackattack.co.uk">track attack</a> website, it&#8217;s a flash site with working back button and the possibility to bookmark a page, and it&#8217;s developed in a similar way to Mike&#8217;s approach.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Matthias</a> on February 8 2006, 05:16 <a href="#comment-426">#</a>
</p>
</li>
<li class="odd" id="comment-428">
<div class="comment-text">Thanks very much, Matthias, I really appreciate it.</div>
<p class="comment-info">by
b on February 8 2006, 12:02 <a href="#comment-428">#</a>
</p>
</li>
<li class="even" id="comment-442">
<div class="comment-text">So how do you get this to work without JSpan and PHP, like if you for example use ASP.Net like me??<br />
<br />
What does doGetPage do??<br />
<br />
Why don&#8217;t you update the script with the suggestions, suggested amongst other by Mark?</div>
<p class="comment-info">by
<a href="http://www.haf.se" rel="nofollow">Henrik</a> on February 15 2006, 10:44 <a href="#comment-442">#</a>
</p>
</li>
<li class="odd" id="comment-443">
<div class="comment-text">Henrik:<br />
<br />
How you hook up your Ajax to your back-end technology isn&#8217;t the point of this article &#8211; that&#8217;s why I used an out-of-the-box solution like JPSpan to deal with that aspect for me. Here I am only concerned with how you trick the browsers into adding to their history and proposing a way to get bookmarking working. This method actually isn&#8217;t limited to Ajax either &#8211; Matthias has got it working for Flash and it would work fine with Eric&#8217;s S5 too.<br />
<br />
doGetPage is the function that gets content from the server side. If you were doing this for yourself that is the function that you would have to change. pageholder is a PHP class on the sever side whose method ashtml returns a string of HTML. It&#8217;s not documented in the article because, as I said before, the transfer method is irrelevant. It&#8217;s all in the zip file though if you want to take a proper look for yourself&#8230;<br />
<br />
I&#8217;ve not updated the script for the same reason I&#8217;ve not written any new articles recently: time! I&#8217;ve just got too much work on to spend much more time on this, which is done completely for free. When I get time I&#8217;ll do some kind of redux but until then I would highly recommend checking out Nobody&#8217;s comments above &#8211; he&#8217;s come up with another method for doing the same thing, based on this one, and Robert Nyman&#8217;s <a href="http://www.robertnyman.com/2006/02/08/ask-ajax-source-kit/">AJAX Source Kit</a>, which looks really good.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on February 15 2006, 12:22 <a href="#comment-443">#</a>
</p>
</li>
<li class="even" id="comment-437">
<div class="comment-text">With a address like http://foo.bar/#foo/bar/ , readability is improved a lot. Compare this with a google map address :-)</div>
<p class="comment-info">by
<a href="http://appuraja.blogspot.com" rel="nofollow">Apoorv S</a> on February 11 2006, 05:27 <a href="#comment-437">#</a>
</p>
</li>
<li class="odd" id="comment-445">
<div class="comment-text">i am looking for smaller companies in united kingdom and USA, that are using this web application called AJAX, were do i find these companies</div>
<p class="comment-info">by
Precious Edokpolo on February 17 2006, 00:19 <a href="#comment-445">#</a>
</p>
</li>
<li class="even" id="comment-481">
<div class="comment-text">Hey guys!<br />
<br />
First of all, thanks a lot for a really useful article, Mike. It gave me exactly the help I was looking for. I&#8217;ve been implementing your methods in a new website I&#8217;m working on for Persnickety Tim&#8217;s Coffee, but I&#8217;ve got this freakish behaviour going on in IE version 6 on the PC, and I can&#8217;t for the life of me figure it out.<br />
<br />
You can see what I&#8217;m talking about at http://test.ptims.com (just open it with IE). The only AJAX-enabled buttons right now are the Buy Coffee links and the Gift Baskets link. Click around between those pages, maybe use the back button once and then click the buttons a couple more times&#8212;first of all, you&#8217;ll see that the window title changes, while the only thing Javascript is changing is the window.location property (I&#8217;ve also tried window.location.href and window.location.hash). Second and more importantly, IE goes to a blank page and the top left icon (above the File menu) changes as well.<br />
<br />
I&#8217;ve been scratching my head for a week on this one. If I comment out the line that changes window.location (or .hash or .href), things work great&#8212;the back button included. But once I try to change window.location, it freaks out. I&#8217;ve tried changing window.location after the iframe src change, before it, I&#8217;ve even had window.location change a couple seconds before changing the iframe src&#8212;the error keeps coming up.<br />
<br />
I&#8217;m on the verge of foregoing the bookmark functionality, but I thought I&#8217;d see if any of you great minds are up for a challenge. I&#8217;ll be grateful for any help. Thanks!</div>
<p class="comment-info">by
<a href="http://www.timscoffee.com" rel="nofollow">Gus Welter</a> on March 11 2006, 00:27 <a href="#comment-481">#</a>
</p>
</li>
<li class="odd" id="comment-448">
<div class="comment-text">Hello Mike and thank you for your answer. I definately know what it&#8217;s like not to have time, and I guess in the end it comes down to my own ability to do tricks with javascript, whether I get it to work as I intend to or not.<br />
<br />
I think my basic problem was that I didn&#8217;t really see what type of data that function returned, and it didn&#8217;t say it was a transfer function. Thanks for the explaination.<br />
<br />
I&#8217;ll have a look at &#8220;Nobody&#8221;&#8217;s comments above, and I have already had a look at Robert&#8217;s Ajax implementation &#8211; it look really great, and I&#8217;m sure I&#8217;ll have a look at it when I get through the exams :p.</div>
<p class="comment-info">by
<a href="http://www.haf.se" rel="nofollow">Henrik</a> on February 22 2006, 03:17 <a href="#comment-448">#</a>
</p>
</li>
<li class="even" id="comment-401">
<div class="comment-text">Hey mate,<br />
this works great!<br />
I modified it a bit in order to make normal anchors work as well and it worked out perfect.<br />
<br />
I tried it in netscape 7.1 as well just for checking compatibility and unfourtunatley it does NOT work there&#8230;though netscape is mozilla based.  Very strange.<br />
<br />
Maybe u can work this out.<br />
<br />
Cheers, Florian</div>
<p class="comment-info">by
Florian on January 29 2006, 06:25 <a href="#comment-401">#</a>
</p>
</li>
<li class="odd" id="comment-402">
<div class="comment-text">Hi can some1 please help me, I tried to log into an account of mine but this keeps coming up: &#8220;you have been log out of your account as the use of the browser back button is not supported&#8221;. This just suddenly happened and I&#8217;ve no idea how to fix it. Please help!!!!!!!!!!!!</div>
<p class="comment-info">by
Phoenix on January 29 2006, 07:28 <a href="#comment-402">#</a>
</p>
</li>
<li class="even" id="comment-463">
<div class="comment-text">I am using Brad Neubergs solution for retaining the back-button functionality, and it works very well.<br />
<br />
There is, however, one thing I do not like (but seems to be IE&#8217;s standard behaviour): the selection box on the back- and forward buttons (for freely selecting any visited page instaed of going just back and forth) always show the full page URI (which is usally so long, it is meaningless, as you only see the server address), where I would only like to see the visited pages title.<br />
<br />
And to my great delight, your demo app does just that: it displays the entry &#8220;Dummy Page&#8221; there!<br />
<br />
How did you achieve that????</div>
<p class="comment-info">by
Winfried Kaiser on March 2 2006, 06:49 <a href="#comment-463">#</a>
</p>
</li>
<li class="odd" id="comment-464">
<div class="comment-text">Great article!<br />
<br />
As far as I understand this, together with at lot of good comments from others, such as &#8220;Nobody&#8221; , may solve my problem. It&#8217;s great that you people are willing to share good ideas with others!<br />
<br />
I may not use your script, but the idea itself was what I needed. <br />
<br />
My users, wich are puples and theachers in Norwegian shools, love the AJAX-solution but miss bookmarking and the buttons. Dealing with that kind of users we really need to take care of this issue. Your solution just gave me hope :)<br />
<br />
My only concern is that this idea triggered me and probably will keep me awake the rest of the night ;)<br />
<br />
Hopefully the browser vendors will give us some solutions, but that may take some time.<br />
<br />
Thank you for taking the time to write the script and the article!<br />
<br />
Winifred: <br />
<br />
I guess the reason why you see long URL&#8217;s in IE&#8217;s selection box  is that you have ben browsing pages whitout a proper title. In my selction boxes I see readable titles when I have been visiting pages with titles&#8230;</div>
<p class="comment-info">by
Frode on March 2 2006, 20:08 <a href="#comment-464">#</a>
</p>
</li>
<li class="even" id="comment-497">
<div class="comment-text">Hey folks ..<br />
<br />
i&#8217;ve a problem .. stuck in the deep end with php and can&#8217;t find a life-jacket ;P<br />
<br />
i&#8217;m trying to serve a php page with &#8216;pageholder.class.php&#8217; .. but can seem to locate a suitable cmd to insert the page into the div ..<br />
<br />
i&#8217;ve tryed a  &#8216;echo &#8220;document.mosteverything(myphp.php)&#8221; &#8217; <br />
<br />
but no avail ..<br />
<br />
also thought a &#8216;document.write&#8217; with a &#8216;include_once&#8217; served in php might do .. but alas no ..<br />
<br />
fast trying to learn js an php so any helps would be most appriciated :)<br />
<br />
ta<br />
<br />
bren<br />
<br />
p.s : i&#8217;m sure this is going to be a duh wheres my brain gone but deadlines do strange things to a mans minds ..</div>
<p class="comment-info">by
<a href="http://www.147online.com" rel="nofollow">Brendan</a> on April 6 2006, 21:49 <a href="#comment-497">#</a>
</p>
</li>
<li class="odd" id="comment-506">
<div class="comment-text">Great work, great article, thanks to share all this code!<br />
i&#8217;ll try to learn from it, my website is in need of a liftup :)</div>
<p class="comment-info">by
<a href="http://www.buzzworkers.com" rel="nofollow">Ben borges</a> on April 9 2006, 12:48 <a href="#comment-506">#</a>
</p>
</li>
<li class="even" id="comment-542">
<div class="comment-text">Dont make it with JPSpan. I am newbie and I donnot understand!<br />
<br />
Please!!!</div>
<p class="comment-info">by
david nguyen on April 18 2006, 00:00 <a href="#comment-542">#</a>
</p>
</li>
<li class="odd" id="comment-546">
<div class="comment-text">David: Sorry if you don&#8217;t understand but this article isn&#8217;t really about Ajax, which is why I used JPSpan &#8211; to take that aspect out of the equation. The point here is the javascript to fix the back button and enable bookmarking.<br />
<br />
There are far better people than me out there writing about implementing your own Ajax apps&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on April 18 2006, 12:39 <a href="#comment-546">#</a>
</p>
</li>
<li class="even" id="comment-548">
<div class="comment-text">I know I am a little late to this discussion. I have been following it but never commented on it.<br />
<br />
My approach so far has been to use a bootstrap page of some sort (pick your flavor of server side language)<br />
<br />
ALL requests are routed through the bootstrap page using your favorite rewrite engine. (mod rewrite in my case) The page then parses out the path in the address bar and stores the values.<br />
<br />
Each controller knows that if is invoked with params that are passed AFTER a # that the request is &#8220;ajaxy&#8221; and behaves as appropriate. If the url doesn&#8217;t have a hash the backend composes a page and returns it.<br />
<br />
The js on the front simply doesn&#8217;t fire if it isn&#8217;t fully supported. Once it fires it finds all link elements that allow ajax style updates of content (via class, id, rel, rev, hash tables of ajax listeners .. doesn&#8217;t matter ) and replaces their real url with the same exact string preceded by a #.<br />
<br />
Without ajax support the links are real url://domain.com/foo/bar style links. With ajax support they are url://domain/#foo/bar style links.<br />
<br />
It is all proof of concept code so far. But if I get it working more nicely I will of course share.<br />
<br />
Sorry if this is off topic. I started to ramble.</div>
<p class="comment-info">by
Abba Bryant on April 18 2006, 16:37 <a href="#comment-548">#</a>
</p>
</li>
<li class="odd" id="comment-613">
<div class="comment-text">Your demo doesn&#8217;t work in Opera at all (links are unclickable), but it looks nice in Firefox.</div>
<p class="comment-info">by
Shadowhand on May 2 2006, 13:10 <a href="#comment-613">#</a>
</p>
</li>
<li class="even" id="comment-648">
<div class="comment-text">I actually read the article and didn&#8217;t find it very helpful, so <strong>I wrote my own back button AJAX fix</strong> with PHP.<br />
<br />
It is available <a href="http://whitemarker.blogspot.com/2006/05/ajax-back-button-fix-with-php-and-html.html">here</a><br />
<br />
It is simpler to use.  Assuming you have PHP setup, you can just pop it onto your webserver and see it work.<br />
<br />
It has a <strong>noframes fix</strong>, so that if someone chooses not to use frames, the site will still work, even if the frames don&#8217;t fix the back button.<br />
<br />
The example I wrote has <strong>code highlighting</strong> so it is easier to read as well.  The main advantage my example is you can just read the code and see how it all works.</div>
<p class="comment-info">by
<a href="http://whitemarker.blogspot.com" rel="nofollow">White Marker</a> on May 11 2006, 16:34 <a href="#comment-648">#</a>
</p>
</li>
<li class="odd" id="comment-722">
<div class="comment-text">Your demo worked fine in Opera and IE7. Great work, and excellent article. In my opinion the most important browsers :)</div>
<p class="comment-info">by
<a href="http://webrama.tk" rel="nofollow">bubblez</a> on May 30 2006, 02:11 <a href="#comment-722">#</a>
</p>
</li>
<li class="even" id="comment-877">
<div class="comment-text">I&#8217;ve been struggling with the back button issue for over a week now and I&#8217;m not any closer to a solution.  The site I am building is still at it&#8217;s early stages and I haven&#8217;t yet added even support for non-IE browsers.  I do not know anything about PHP and I can&#8217;t tell if I can even implement the solutions discussed here since I already came up with my own bookamrking scheme and I&#8217;m using frames besides.  If anyone has any suggestions, please let me know.  I can post any code that people would want to see or even allow anonymous read access to the folder that contains all of my current source.</div>
<p class="comment-info">by
<a href="http://www.allthingscomp.com/frame1.htm" rel="nofollow">Conn Buckley</a> on June 14 2006, 17:45 <a href="#comment-877">#</a>
</p>
</li>
<li class="odd" id="comment-876">
<div class="comment-text">Great article!  Helped me out tremendously. I used it to create a much simplified version for Flash.<br />
<br />
StoneArch &#8211; Page 1<br />
<br />
    var currentUrl = &#8220;&#8221;;<br />
    var intervalId = 0;<br />
<br />
 // Start the timer and read the initial Url<br />
    function init() {<br />
        currentUrl = window.location.href;<br />
        intervalId = window.setInterval(checkForUrlChanges, 10);<br />
    }<br />
<br />
// Add to the history<br />
function addBookmark(page, title) {<br />
        document.title = title;<br />
        currentUrl = &#8220;mockpage.html?id=&#8221; + page;<br />
        window.frames[&#8220;mockPage&#8221;].location.href = currentUrl;<br />
} <br />
<br />
// Check for changes in the Url, if they occur update the Flash movie<br />
    function checkForUrlChanges() {<br />
        if (currentUrl != window.frames[&#8220;mockPage&#8221;].location.href) {<br />
            currentUrl = window.frames[&#8220;mockPage&#8221;].location.href;<br />
            var items = window.frames[&#8220;mockPage&#8221;].location.search.split(&#8221;=&#8221;);<br />
            thisMovie(&#8220;AnchorTest&#8221;).gotoBookmark(items<sup><a href="#fn1">1</a></sup>);<br />
        }<br />
    }<br />
<br />
// Find the Flash movie                <br />
    function thisMovie(movieName) {<br />
        if (navigator.appName.indexOf(&#8220;Microsoft&#8221;) != -1) {<br />
            return window[movieName]<br />
        }<br />
        else {<br />
            return document[movieName]<br />
        }<br />
    }<br />
<br />
</div>
<p class="comment-info">by
David LaTour on June 14 2006, 15:58 <a href="#comment-876">#</a>
</p>
</li>
<li class="even" id="comment-856">
<div class="comment-text">hi all<br />
a very good article but can anyone suggest some basic article if we not use php but wish such back and bookmarking facility in iframe<br />
                          Thanks &#38; Regards<br />
                            saurabh</div>
<p class="comment-info">by
saurabh gandhi on June 9 2006, 02:59 <a href="#comment-856">#</a>
</p>
</li>
<li class="odd" id="comment-950">
<div class="comment-text">So many comments!  I&#8217;m very pleased to see that you tend to this article and respond to the comments Mike.  Kudos!  Between your solution, and the information you&#8217;ve provided about it, the comments, the answers, and the alternate solutions proposed, including Nobody&#8217;s, I&#8217;m sure I&#8217;ll be able to put together a portable collection with this functionality to fix the apps that I&#8217;ve written.  I&#8217;ve been meaning to consider back buttons and bookmarking, but it wasn&#8217;t until today when my girlfriend pointed out those exact issues with my new photo search that I realized it&#8217;s time to take them seriously!<br />
<br />
I know this isn&#8217;t the place for advertising AJAX apps, but I&#8217;ve gotten into writing them recently, and I&#8217;m pretty excited about my photo search app: www.jcbeck.com/photos/javascript.asp<br />
This is the &#8220;beta&#8221; url, which shall remain here, but I may put this &#8220;live&#8221; at some point either at this url or another.  Thanks for those who stop by!</div>
<p class="comment-info">by
<a href="http://www.jcbeck.com/" rel="nofollow">Jason Beck</a> on June 28 2006, 17:04 <a href="#comment-950">#</a>
</p>
</li>
<li class="even" id="comment-1549">
<div class="comment-text">Peter: This approach is unobtrusive so your links should all be in the standard server-side form with normal querystrings &#8211; something like /yourpage.php?id=4. At runtime the DOM script then runs through and hijacks them, turning them into /yourpage.php#id=4. Google will see the ? ones while the user interacts with the # versions. Does that make sense?</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on September 13 2006, 11:34 <a href="#comment-1549">#</a>
</p>
</li>
<li class="odd" id="comment-1546">
<div class="comment-text">Hi,<br />
<br />
Has anyone noticed that using the rshf in IE you see a loading bar in the status bar when navigating the o&#8217;reilly mail example (<br />
http://shrinkster.com/i51 ). This seems to go against the ajax concept of not seeing any page refresh/loading?<br />
<br />
Any thoughts appreciated.<br />
<br />
Thanks<br />
Kieran</div>
<p class="comment-info">by
<a href="http://www.perryworld.com" rel="nofollow">Kieran</a> on September 10 2006, 14:33 <a href="#comment-1546">#</a>
</p>
</li>
<li class="even" id="comment-1164">
<div class="comment-text">I&rsquo;ve been struggling with the back button issue for over a week now and I&rsquo;m not any closer to a solution. The site I am building is still at it&rsquo;s early stages and I haven&rsquo;t yet added even support for non-IE browsers. I do not know anything about PHP and I can&rsquo;t tell if I can even implement the solutions discussed here since I already came up with my own bookamrking scheme and I&rsquo;m using frames besides. If anyone has any suggestions, please let me know. I can post any code that people would want to see or even allow anonymous read access to the folder that contains all of my current source.</div>
<p class="comment-info">by
Amit Aher on July 27 2006, 09:59 <a href="#comment-1164">#</a>
</p>
</li>
<li class="odd" id="comment-1391">
<div class="comment-text">Hi Nobody,<br />
<br />
i think i just figured it out.<br />
<br />
It&#8217;s in ie.js, the function chkHrf()<br />
<br />
i changed  window.location.href = &#8221;/21/#&#8221; + nhrf; to<br />
window.location.href = &#8221;./test.htm/#&#8221; + nhrf;<br />
<br />
Let me know if i am on the right path, coz that works just fine. Thought i should put it in here so that others can use it as well&#8230;<br />
<br />
Please let me know if i have to make any changes anywhere else. For a working demo, have a look at <br />
http://www.webhostingfx.com/gtek/newajaxnav/test.htm<br />
<br />
Cheers,</div>
<p class="comment-info">by
<a href="http://www.webhostingfx.com" rel="nofollow">desperado</a> on August 13 2006, 22:41 <a href="#comment-1391">#</a>
</p>
</li>
<li class="even" id="comment-1548">
<div class="comment-text">Hi, I have been following this article and responses for a few months. Although I feel that the solution you present is nothing short of brilliant, I have some reservations regarding Google and SEO. Will Google uniquely crawl and add to its banks urls of the type generated here? i.e. does Google see url#bob and url#mary as two unique links with unique content? Any comments would be highly appreciated.</div>
<p class="comment-info">by
Peter on September 13 2006, 11:23 <a href="#comment-1548">#</a>
</p>
</li>
<li class="odd" id="comment-1198">
<div class="comment-text">Sweet! I was just looking for something like this&#8212;came here via google. That&#8217;s pretty sweet, man. I can&#8217;t wait to adapt it for my stupid project&#8230;</div>
<p class="comment-info">by
<a href="http://jonroig.com" rel="nofollow">Jon Roig</a> on August 1 2006, 21:32 <a href="#comment-1198">#</a>
</p>
</li>
<li class="even" id="comment-1525">
<div class="comment-text">Hello,<br />
<br />
FYI:<br />
<br />
The <a href="http://donotremove.co.uk/extra/ajax-nav/index.html">demo</a> provided does not work on IE6 WinXP SP2 (IE 6.0.2900.2180.xpsp_sp2_gdr.050301-1519)<br />
<br />
but <a href="http://www.chudosok.info/">this</a> one provided by nobody does.</div>
<p class="comment-info">by
dnk.nitro on August 29 2006, 10:06 <a href="#comment-1525">#</a>
</p>
</li>
<li class="odd" id="comment-1526">
<div class="comment-text">It works fine for me in IE6/XPsp2&#8230;</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on August 29 2006, 10:23 <a href="#comment-1526">#</a>
</p>
</li>
<li class="even" id="comment-1212">
<div class="comment-text">>I say eval() is a necessary evil since Javascript >has almost no support for reflection. (No way to >dynamically call functions, dynamically assign >variables, etc.)<br />
<br />
Wow&#8230; <br />
<br />
x? y() : z();<br />
x = y || z;<br />
x();<br />
<br />
x = a? y : z;<br />
x = x || y;<br />
if(x) var y = z; else var y = b;<br />
<br />
I thought that was all quite easy.</div>
<p class="comment-info">by
<a href="http://aboutrefinancing.org" rel="nofollow">Refinancing Guy</a> on August 4 2006, 16:47 <a href="#comment-1212">#</a>
</p>
</li>
<li class="odd" id="comment-1390">
<div class="comment-text">Hi Nobody,<br />
<br />
First and foremost, thank you for the script, people like you are life savers for people like me. But i need your help.<br />
<br />
I have setup your pages on my server, but it seems the back button doesn&#8217;t work proplery. Can you please guide me.<br />
[link] http://www.webhostingfx.com/gtek/newajaxnav/test.htm<br />
<br />
This is what happens:<br />
When i click the back button it goes to<br />
http://www.webhostingfx.com/21/#home<br />
<br />
How can i change this?<br />
<br />
Thanks a lot<br />
desperado</div>
<p class="comment-info">by
<a href="http://www.webhostingfx.com" rel="nofollow">desperado</a> on August 13 2006, 22:04 <a href="#comment-1390">#</a>
</p>
</li>
<li class="even" id="comment-1551">
<div class="comment-text">Hi Mike &#8211; don&#8217;t post this &#8211; just responding to your response re SEO and Google: I feel like a righteous ass &#8211; my brain bypassed that section of the article completely. How weird&#8230; I&#8217;m a bit freaked out ;-) Anyway, you make total sense. Thanks again for a truly brilliant solution. I&#8217;ll send you a link to my site once it&#8217;s done so you can see another implementation in action. Best wishes. Peter.</div>
<p class="comment-info">by
Peter on September 14 2006, 09:19 <a href="#comment-1551">#</a>
</p>
</li>
<li class="odd" id="comment-1588">
<div class="comment-text">The demo works fine in Firefox 1.0, but try this in Firefox 1.5 (PC or Mac):<br />
<br />
1) Open the demo<br />
2) Click on page 2<br />
3) Open any page outside of the demo (e.g. Google)<br />
4) Click the back button<br />
<br />
The hash should say #2 and page 2, but instead it&#8217;s page 1 and no hash. It actually goes back to the hash value (or lack thereof) when the page was first opened. If you try this test by going to page 3 directly first (with #3) in step 1, at step 4 it&#8217;ll be page 3 again.<br />
<br />
It appears to only be a &#8220;cosmetic&#8221; bug; the value in location.hash is wrong, but if you click reload or go back then forward again, the right page/hash shows up. My theory is that this is caused by the page being still in the session history / fastback cache (new with 1.5), but I haven&#8217;t turned it off to test it completely. (If after step 3 you visit more than 8 pages then go back to the demo in step 4, which should flush the demo out of the cache, the right page/hash appears).<br />
<br />
Has anyone seen the same behaviour before? Any workaround or information (even a bugilla report)?</div>
<p class="comment-info">by
<a href="http://www.thingsthemselves.com" rel="nofollow">Jeffery To</a> on October 4 2006, 05:42 <a href="#comment-1588">#</a>
</p>
</li>
<li class="even" id="comment-2015">
<div class="comment-text">Recently implemented a solution that was originally based on Brad Neuberg&#8217;s code but now has the advantages of having been cleaned up a bit and, best of all, no longer requires a separate iframe.  This means that IE will not hit the webserver with a request every time the back button is clicked.  The code can be found here:<br />
http://cvs.horde.org/dimp/js/src/dhtmlHistory.js<br />
<br />
Usage is as simple as (in an onload function):<br />
if (dhtmlHistory.initialize()) {<br />
    dhtmlHistory.addListener([insert function here]);<br />
}<br />
<br />
Code does require Prototype 1.5.1+.</div>
<p class="comment-info">by
<a href="http://www.horde.org/" rel="nofollow">Michael</a> on March 20 2007, 02:31 <a href="#comment-2015">#</a>
</p>
</li>
<li class="odd" id="comment-1595">
<div class="comment-text">Hello,<br />
your abstract is really good and above all very easy to understand (even for me with only litte js-knowledge).<br />
<br />
My aim is it to add the following way of opening the adress: index.php#hash=site1 instead of the id: index.php#hash=1<br />
This is particularly important for me (administrating the side, therefore i do not need to know all the numbers).<br />
Do you have an idea, how to implement this very easy?  <br />
<br />
Today, i&#8217;ve prepared the pageholding.class to load the sites out of a mysql-db. It&#8217;s so easy now to adminstrate my site :). Thank you!!!</div>
<p class="comment-info">by
Phoenix on October 10 2006, 14:09 <a href="#comment-1595">#</a>
</p>
</li>
<li class="even" id="comment-1602">
<div class="comment-text">This works in Safari 2</div>
<p class="comment-info">by
David Jackson on October 13 2006, 10:25 <a href="#comment-1602">#</a>
</p>
</li>
<li class="odd" id="comment-1692">
<div class="comment-text">:)<br />
this article is really commented!!!!<br />
very nice&#8230;.<br />
the example, the comments, the community&#8230;.<br />
the point is&#8230;<br />
i wonder<br />
can browser applications written in ajax and some server side script replace the standalone applications made in vb or c#<br />
thanx</div>
<p class="comment-info">by
<a href="http://vsnetworks.hr" rel="nofollow">sven</a> on October 30 2006, 08:57 <a href="#comment-1692">#</a>
</p>
</li>
<li class="even" id="comment-1715">
<div class="comment-text">I think both Mike&#8217;s and my solution needs a rewrite. Both seem to be incompatible with the latest Firefox and Opera.</div>
<p class="comment-info">by
Nobody on November 9 2006, 19:31 <a href="#comment-1715">#</a>
</p>
</li>
<li class="odd" id="comment-1861">
<div class="comment-text">Nice code, i will try to implement in my website. But your demo page does not work at all in Opera.</div>
<p class="comment-info">by
<a href="http://www.qwerq.com" rel="nofollow">william</a> on December 17 2006, 04:47 <a href="#comment-1861">#</a>
</p>
</li>
<li class="even" id="comment-1862">
<div class="comment-text">Here&#8217;s the fix for Opera.<br />
<br />
http://www.quirksmode.org/bugreports/archives/2004/11/load_and_unload.html<br />
(comment 15)<br />
http://bloomd.home.mchsi.com/opera-onload.html<br />
<br />
Tested in Opera 9.</div>
<p class="comment-info">by
<a href="http://www.Owen-M.com" rel="nofollow">Owen Maule</a> on December 19 2006, 18:01 <a href="#comment-1862">#</a>
</p>
</li>
<li class="odd" id="comment-1863">
<div class="comment-text">Did anyone notice that IE DOES in fact create a new history entry if the # part of the URL is changed to an anchor tag that actually exists?  One solution to the IE problem (as opposed to the hidden IFRAME) is to have a container div that you inject an anchor tag into just before changing location.hash.  Here&#8217;s an example:<br />
<br />
&lt;script><br />
  function handleClick() {<br />
    var newAnchor;<br />
    // Do some Ajax type thing that sets newAnchor.<br />
<br />
    $(&#8216;container&#8217;).innerHTML = &#8220;&#8221;;<br />
    location.hash = newAnchor;<br />
  }<br />
&lt;/script><br />
<br />
&lt;div id=&#8221;container&#8221;>&lt;/div><br />
<br />
&lt;a href=&#8221;#&#8221; onclick=&#8221;handleClick(); return false;&#8221; /></div>
<p class="comment-info">by
<a href="http://www.millssoftware.com" rel="nofollow">Ben Mills</a> on December 20 2006, 14:30 <a href="#comment-1863">#</a>
</p>
</li>
<li class="even" id="comment-1728">
<div class="comment-text">Regarding Safari, bookmarking does work, the back button doesn&#8217;t. The back button is fixed in the Safari nightly builds, so the fix will show up in a future version of Safari.</div>
<p class="comment-info">by
Duncan on November 13 2006, 16:30 <a href="#comment-1728">#</a>
</p>
</li>
<li class="odd" id="comment-1880">
<div class="comment-text">@Ben:<br />
<br />
I noticed that too. I used it to my favour by setting the value of &#8220;document.documentElement.id&#8221; to whatever my URL fragment was going to be in the same same function as the one that changes window.location &#8211; that way there is no need to create any extra markup to handle this in IE. For example:<br />
<br />
function UpdateAddressBar(address) {<br />
&nbsp;&nbsp;&nbsp;&nbsp;document.documentElement.id = address;<br />
&nbsp;&nbsp;&nbsp;&nbsp;window.location.href = &#8221;#&#8221; + address<br />
}<br />
<br />
Is what I used to get around this issue, where &#8216;address&#8217; is the URL fragment identified in another part of my script.</div>
<p class="comment-info">by
<a href="http://electricfreedom.org" rel="nofollow">Dylan Parry</a> on January 9 2007, 09:04 <a href="#comment-1880">#</a>
</p>
</li>
<li class="even" id="comment-1741">
<div class="comment-text">As people have noted already, the example doesn&#8217;t work at all in Opera (v9.02/Win for me). Can&#8217;t open the three pages and the back button is seriously broken.<br />
<br />
@Matthias Willerich &#8211; Opera added XmlHttpRequest in v8.0 (http://www.opera.com/docs/changelogs/windows/800/) so yes it&#8217;s now in the major release. Initial support wasn&#8217;t perfect but seems far more robust in 9.</div>
<p class="comment-info">by
<a href="http://weblog.200ok.com.au/" rel="nofollow">Ben Buchanan</a> on November 14 2006, 23:04 <a href="#comment-1741">#</a>
</p>
</li>
<li class="odd" id="comment-1973">
<div class="comment-text">This is all well and good but because search engine crawlers don&#8217;t execute JavaScript they will never see the correct page accessed with a # url. So this approach is not SEO friendly.</div>
<p class="comment-info">by
<a href="http://www.secretartgallery.com" rel="nofollow">Matt</a> on February 19 2007, 00:39 <a href="#comment-1973">#</a>
</p>
</li>
<li class="even" id="comment-1976">
<div class="comment-text">@Matt: Look in the source. There aren&#8217;t any href=&#8221;#&#8221; attributes &#8211; all the links work without JS. That&#8217;s the point.</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on February 19 2007, 06:26 <a href="#comment-1976">#</a>
</p>
</li>
<li class="odd" id="comment-1979">
<div class="comment-text">This is really more of a experiment/proof-of-concept kind of thing. I believe that neither Mike nor me meant this to be used as a main means of navigation for a serious website (this one doesn&#8217;t use it, for example). We basically reinvented the wheel with Javascript here, that&#8217;s all. We proved it can be done.</div>
<p class="comment-info">by
Nobody on February 21 2007, 03:09 <a href="#comment-1979">#</a>
</p>
</li>
<li class="even" id="comment-1980">
<div class="comment-text">ak, sorry, forgot to address my previous comment to Matt. A little crarification as well: the site navigation thing is the experiment/proof-of-concept. The actual code and technology utulized here is useful for AJAX apps that don&#8217;t need a search engine or anything but that would need to save the state of an app in the back/forward buffers and into bookmarks, such as Google Maps.</div>
<p class="comment-info">by
Nobody on February 21 2007, 03:20 <a href="#comment-1980">#</a>
</p>
</li>
<li class="odd" id="comment-2024">
<div class="comment-text">Michael,<br />
I&#8217;ve had a brief look at it, and it looks like a very nice and clean implementation, and well documented, too!<br />
<br />
From what I could see, the solution is mainly (only?) for Firefox and IE. I wonder if and when someone finds the time to do a nicely coded solution that contains the Safari solution as well.<br />
Then again, the one that I was told of, was based on a bug, so that might be fixed with the next release and &#8220;break&#8221; the back button&#8230;<br />
Is there a test case for this anywhere online?</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Matthias</a> on March 27 2007, 17:09 <a href="#comment-2024">#</a>
</p>
</li>
<li class="even" id="comment-1968">
<div class="comment-text">I fixed my script, and even though it is still a lottle bit messy, it works in all the latest versions (IE 6 and 7, FFx 2, O 9) of the current browsers. http://chudosok.info</div>
<p class="comment-info">by
Nobody on February 12 2007, 19:44 <a href="#comment-1968">#</a>
</p>
</li>
<li class="odd" id="comment-1985">
<div class="comment-text">@Nobody: I think Matt&#8217;s missed that the script works unobtrusively so there actually aren&#8217;t any href=&#8221;#&#8221; in the HTML&#8230; Still, I agree with you as well &#8211; it&#8217;s probably not a good idea to use Ajax as the primary means of navigation!</div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Mike Stenhouse</a> on February 22 2007, 12:49 <a href="#comment-1985">#</a>
</p>
</li>
<li class="even" id="comment-2093">
<div class="comment-text">Ok, I understand the usage but why??? If you are creating a TRUE &#8220;Internet application&#8221;, open the damn thing into a modal-style window with no nav buttons.  <br />
<br />
You are not enhancing the user&#8217;s experience by using AJAX instead of an IFRAME.  You are just creating more work for yourself. <br />
<br />
I use AJAX for internet applications.  Constructed correctly, an Internet Application does not need all of this unnecessary JavaScript and hidden frame garbage.  Everyone thinks that the BACK button is an AJAX hindrance; it is not.  A website that uses AJAX to load content into a DIV container is just plain foolish and a waste of time.  Don&#8217;t use AJAX because it is &#8220;cool and nifty&#8221;, use it only when it is the BETTER alternative.  <br />
<br />
Use AJAX to run API style calls and &#8220;change&#8221; the layout of the page dynamically, not import HTML.<br />
<br />
To each their own I guess.</div>
<p class="comment-info">by
craig on June 27 2007, 14:58 <a href="#comment-2093">#</a>
</p>
</li>
<li class="odd" id="comment-2278">
<div class="comment-text">Is there a way to do this without all the extra files and stuff? Is there just a javascript function that adds what page you loaded to the history or something?<br />
<br />
I&#8217;m working on a forum, but I can&#8217;t have this many extra scripts lying around.</div>
<p class="comment-info">by
DoubleAW on August 16 2007, 12:36 <a href="#comment-2278">#</a>
</p>
</li>
<li class="even" id="comment-2422">
<div class="comment-text">Is there a way to do this without all the extra files and stuff? Is there just a javascript function that adds what page you loaded to the history or something?</div>
<p class="comment-info">by
<a href="http://astore.amazon.com/sharp-aquos-20" rel="nofollow">sharp aquos</a> on December 19 2007, 16:34 <a href="#comment-2422">#</a>
</p>
</li>
<li class="odd" id="comment-2305">
<div class="comment-text">Maybe browser manufacturers should fix the back button to make it work with our Ajax scripts, instead of us fixing our Ajax scripts to work with the browsers&#8230; ? It would make life a lot easier!<br />
<br />
This article is great! Thanks for putting your time and effort into fixing the back button, so we didn&#8217;t need to use our brains as much! ;)</div>
<p class="comment-info">by
<a href="http://www.olivertreend.com" rel="nofollow">Oliver Treend</a> on August 24 2007, 16:12 <a href="#comment-2305">#</a>
</p>
</li>
<li class="even" id="comment-2352">
<div class="comment-text">Have anyone tried unFocus?</div>
<p class="comment-info">by
<a href="http://dmitry.eu" rel="nofollow">Solid</a> on October 24 2007, 03:28 <a href="#comment-2352">#</a>
</p>
</li>
<li class="odd" id="comment-2421">
<div class="comment-text">Maybe browser manufacturers should fix the back button to make it work with our Ajax scripts, instead of us fixing our Ajax scripts to work with the browsers&hellip; ? It would make life a lot easier!</div>
<p class="comment-info">by
<a href="http://astore.amazon.com/sharp-aquos-20" rel="nofollow">sharp aquos</a> on December 19 2007, 16:33 <a href="#comment-2421">#</a>
</p>
</li>
<li class="even" id="comment-2478">
<div class="comment-text">Is it at all possible to get this sort of functionality for Opera and Safari? Thanks for the gr8 article Mike?</div>
<p class="comment-info">by
Joseph on January 17 2008, 17:41 <a href="#comment-2478">#</a>
</p>
</li>
<li class="odd" id="comment-2199">
<div class="comment-text">Great links, thanks. You&#8217;ve set this article up very well. Harry Fuecks&#8217;s stuff is excellent and well recommended (JPSpan.)<br />
<br />
I&#8217;ve also been having some trouble with IE7 on this, but managed to get a work around. Great Ajax functionality, much appreciated.<br />
<br />
Lastly, eval does have some uses, even if it is evil!<br />
<br />
Thanks again</div>
<p class="comment-info">by
<a href="http://www.factoryfast.com.au" rel="nofollow">linen</a> on July 29 2007, 11:26 <a href="#comment-2199">#</a>
</p>
</li>
<li class="even" id="comment-2206">
<div class="comment-text">Hello,<br />
<br />
I am using a browser with a built in back button, it&#8217;s free and pretty decent. The name is Firefox, Google it. <br />
<br />
Seriously, the back button doesn&#8217;t need fixing, it&#8217;s not broken. The websites you mention need to be fixed. Each website that decides to implement &#8216;custom&#8217; navigation is so arrogant in presuming that users will not miss the back button behavior that they have to provide that themselves. Otherwise, their funky navigation is just broken.<br />
<br />
To the websites that decide to break the back button: Try a usability test, almost all users know and use the back button, it&#8217;s big and it&#8217;s the first one on the row. Where do you go off breaking such a fundamental part of the User Experience?<br />
<br />
End of rant </div>
<p class="comment-info">by
Mike on July 30 2007, 10:23 <a href="#comment-2206">#</a>
</p>
</li>
<li class="odd" id="comment-2454">
<div class="comment-text">You really just want to put the ajax requests on a stack and pop of the last request when the backbutton event is fired.  What is wrong with that ??</div>
<p class="comment-info">by
agent_orange on January 7 2008, 23:05 <a href="#comment-2454">#</a>
</p>
</li>
<li class="even" id="comment-2455">
<div class="comment-text">@agent_orange: This article was about detecting a back button event, since the browsers don&#8217;t expose one to Javascript. What you do with that information once you have it is up to you&#8230;</div>
<p class="comment-info">by
<a href="http://donotremove.co.uk" rel="nofollow">Mike Stenhouse</a> on January 8 2008, 10:49 <a href="#comment-2455">#</a>
</p>
</li>
<li class="odd" id="comment-2363">
<div class="comment-text">Thanks very much, Matthias, I really appreciate it&#8230;</div>
<p class="comment-info">by
<a href="http://www.tercume-burosu.org" rel="nofollow">Tercme brosu</a> on October 28 2007, 22:10 <a href="#comment-2363">#</a>
</p>
</li>
<li class="even" id="comment-2436">
<div class="comment-text">sharp, see the &#8216;salajax&#8217; article mentioned above, it has a javascript library that is easy to use and handles the back button etc.</div>
<p class="comment-info">by
<a href="http://www.codeproject.com/KB/ajax/Salajax.aspx" rel="nofollow">salajax</a> on December 27 2007, 22:00 <a href="#comment-2436">#</a>
</p>
</li>
<li class="odd" id="comment-2403">
<div class="comment-text">There is an article located here<br />
<br />
http://www.codeproject.com/KB/ajax/Salajax.aspx<br />
<br />
that uses a lot of the techniques outlined in this article but simplifies them by providing a class to do all the hard work, the library is extremely easy to use and seems to work very well.</div>
<p class="comment-info">by
<a href="http://www.codeproject.com/KB/ajax/Salajax.aspx" rel="nofollow">salajax</a> on December 3 2007, 23:02 <a href="#comment-2403">#</a>
</p>
</li>
<li class="even" id="comment-2472">
<div class="comment-text">Nice code, i will try to implement in my website. But your demo page does not work at all in Opera..</div>
<p class="comment-info">by
<a href="http://www.ceviriservisi.com" rel="nofollow">eviri</a> on January 16 2008, 04:06 <a href="#comment-2472">#</a>
</p>
</li>
<li class="odd" id="comment-3668">
<div class="comment-text">You&#8217;re right &#8211; click then back must be one of the most fundamental things about the internet and if that can&#8217;t work then everything else (even if it can) will just not be looked at in the same light. It&#8217;s a fundamentally fundamental. You really can&#8217;t expect to go ahead and design without ensuring something so utterly basic is taken care of.</div>
<p class="comment-info">by
<a href="http://www.factoryfast.com.au" rel="nofollow">linen</a> on July 29 2008, 15:15 <a href="#comment-3668">#</a>
</p>
</li>
<li class="even" id="comment-3753">
<div class="comment-text">Your demo page is broken</div>
<p class="comment-info">by
Beren on August 27 2008, 06:13 <a href="#comment-3753">#</a>
</p>
</li>
<li class="odd" id="comment-4078">
<div class="comment-text">I had problems with this.  I constructed a BETTER SOLUTION with a WORKING DEMO.  Click on my name to see the solution.</div>
<p class="comment-info">by
<a href="http://whitemarker.blogspot.com" rel="nofollow">blacklight</a> on October 2 2008, 14:48 <a href="#comment-4078">#</a>
</p>
</li>
<li class="even" id="comment-4771">
<div class="comment-text">Excelent article, quite usefull.

Isn't it easier though to simple have the loaded iframe execute a script to update it's parent hash? Then you only have to poll the hash, which you're doing in <strong>normal</strong> (non-microsoft) browsers anyway.

You still have to make sure you don't do the same in IE and other browsers but it saves some code.

So your iframe calls this script from the body (or head for that matter). Assuming you use #var=val#var2=val2 syntax for the hash.
<code>
if (parent)
{
  var query			 = window.location.search;
  var hash			 = query.replace(/[?&amp;;]/gi, "#");
  parent.location.hash		 = hash;
}
</code>

Then you only have to plug the iframe in IE and the rest works the same as always. No need for polling the iframes location or a function in the iframe.
</div>
<p class="comment-info">by
Maarten on November 29 2008, 20:47 <a href="#comment-4771">#</a>
</p>
</li>
<li class="odd" id="comment-4403">
<div class="comment-text"><p>Hello there. Going through things after the relaunch, and seen that the demo was broken, due to a bug in JPSPAN. I fixed this and uploaded a new version. Please refer to the bug description on the JPSPAN sourceforge page.  Also, if you folks out there are utilizing the YUI framework (which I'm a big fan of), then it's worth looking into the <a href="http://developer.yahoo.com/yui/history/">Browser History Manager</a>, which should do the same thing for you ...</p></div>
<p class="comment-info">by
<a href="http://contentwithstyle.pascalopitz.com" rel="nofollow">Pascal Opitz</a> on October 29 2008, 07:38 <a href="#comment-4403">#</a>
</p>
</li>

    </ul>
</div>

            </div>

            <div class="sidebar">
                <div class="box info">
    <h2>Content with Style?</h2>

    <p>
        Content with Style is a London based blog, focusing on web technology and related topics.
    </p>
</div>
                <!-- AddThis Button BEGIN -->
<div class="bookmarks">
    <script type="text/javascript">var addthis_pub="contentwithstyle";</script>
    <a href="http://www.addthis.com/bookmark.php?v=20" onmouseover="return addthis_open(this, '', '[URL]', '[TITLE]')" onmouseout="addthis_close()" onclick="return addthis_sendto()"><img src="http://s7.addthis.com/static/btn/lg-bookmark-en.gif" width="125" height="16" alt="Bookmark and Share" style="border:0"/></a>
    <script type="text/javascript" src="http://s7.addthis.com/js/200/addthis_widget.js"></script>
</div>
<!-- AddThis Button END -->

                <p class="rss-link">
    <a href="/atom.xml">Grab our feed</a>
</p>

                <div class="box date">
    <h2>Browse by Date</h2>
    <h3>2011</h3><ul class="clearfix"><li><a href="/archive/date/2011/March">March</a></li><li><a href="/archive/date/2011/January">January</a></li></ul><h3>2010</h3><ul class="clearfix"><li><a href="/archive/date/2010/December">December</a></li><li><a href="/archive/date/2010/November">November</a></li><li><a href="/archive/date/2010/October">October</a></li><li><a href="/archive/date/2010/September">September</a></li><li><a href="/archive/date/2010/August">August</a></li><li><a href="/archive/date/2010/May">May</a></li><li><a href="/archive/date/2010/April">April</a></li><li><a href="/archive/date/2010/March">March</a></li><li><a href="/archive/date/2010/January">January</a></li></ul><h3>2009</h3><ul class="clearfix"><li><a href="/archive/date/2009/November">November</a></li><li><a href="/archive/date/2009/October">October</a></li><li><a href="/archive/date/2009/August">August</a></li><li><a href="/archive/date/2009/July">July</a></li><li><a href="/archive/date/2009/June">June</a></li><li><a href="/archive/date/2009/May">May</a></li><li><a href="/archive/date/2009/April">April</a></li><li><a href="/archive/date/2009/March">March</a></li><li><a href="/archive/date/2009/February">February</a></li><li><a href="/archive/date/2009/January">January</a></li></ul><h3>2008</h3><ul class="clearfix"><li><a href="/archive/date/2008/December">December</a></li><li><a href="/archive/date/2008/November">November</a></li><li><a href="/archive/date/2008/October">October</a></li><li><a href="/archive/date/2008/September">September</a></li><li><a href="/archive/date/2008/August">August</a></li><li><a href="/archive/date/2008/July">July</a></li><li><a href="/archive/date/2008/June">June</a></li><li><a href="/archive/date/2008/May">May</a></li><li><a href="/archive/date/2008/April">April</a></li></ul><h3>2007</h3><ul class="clearfix"><li><a href="/archive/date/2007/December">December</a></li><li><a href="/archive/date/2007/November">November</a></li><li><a href="/archive/date/2007/October">October</a></li><li><a href="/archive/date/2007/August">August</a></li><li><a href="/archive/date/2007/July">July</a></li><li><a href="/archive/date/2007/June">June</a></li><li><a href="/archive/date/2007/May">May</a></li><li><a href="/archive/date/2007/April">April</a></li><li><a href="/archive/date/2007/March">March</a></li><li><a href="/archive/date/2007/February">February</a></li><li><a href="/archive/date/2007/January">January</a></li></ul><h3>2006</h3><ul class="clearfix"><li><a href="/archive/date/2006/November">November</a></li><li><a href="/archive/date/2006/October">October</a></li><li><a href="/archive/date/2006/September">September</a></li><li><a href="/archive/date/2006/August">August</a></li><li><a href="/archive/date/2006/July">July</a></li><li><a href="/archive/date/2006/June">June</a></li><li><a href="/archive/date/2006/May">May</a></li><li><a href="/archive/date/2006/April">April</a></li><li><a href="/archive/date/2006/March">March</a></li><li><a href="/archive/date/2006/February">February</a></li></ul><h3>2005</h3><ul class="clearfix"><li><a href="/archive/date/2005/October">October</a></li><li><a href="/archive/date/2005/September">September</a></li><li><a href="/archive/date/2005/July">July</a></li><li><a href="/archive/date/2005/June">June</a></li><li><a href="/archive/date/2005/May">May</a></li></ul>
</div>

            </div>

            <div class="ads">
    <script type="text/javascript" src="http://www.globalgiving.org/javascript/widget/widget.js">  { "projectids" : "46642"  }  </script>
</div>

        </div>

        <ul>

        </ul>

        <div class="footer">
    <p class="bottom-logo">Content with Style</p>
    <p>Copyright 2006-2011 Content with Style, All rights reserved.</p>
</div>

<script type="text/javascript" src="/3rdparty/jquery/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="/3rdparty/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/default/js/cws.js"></script>

    </body>
</html>

